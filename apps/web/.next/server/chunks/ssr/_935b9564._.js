module.exports=[692759,183952,a=>{"use strict";var b=a.i(170106);let c=(0,b.default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);a.s(["Send",()=>c],692759);let d=(0,b.default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);a.s(["Paperclip",()=>d],183952)},976695,a=>{"use strict";let b=(0,a.i(170106).default)("file",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);a.s(["FileIcon",()=>b],976695)},527415,563588,a=>{"use strict";var b=a.i(187924),c=a.i(572131);a.i(511241);var d=a.i(296373),e=a.i(898003),f=a.i(130487),g=a.i(757215),h=a.i(448645),i=a.i(165004),j=a.i(629353),k=a.i(692759),l=a.i(183952),m=a.i(633508),n=a.i(976695),o=a.i(596221);function p({entityType:a,entityId:p,entityName:q,onMentionCreated:r}){let[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(new Map),E=(0,c.useRef)(null),F=(0,c.useRef)(null),G=(0,j.useToast)(),{memberships:H}=(0,e.useOrganization)({memberships:{infinite:!0}}),I=(0,d.useQuery)(f.api.users.listByOrg),J=(0,d.useMutation)(f.api.notifications.createMention),K=(0,d.useMutation)(f.api.users.syncUserFromClerk),L=(0,d.useMutation)(f.api.messageAttachments.generateUploadUrl),M=H?.data?.map(a=>{let b=a.publicUserData;if(!b||!b.userId)return null;let c=I?.find(a=>a.email===b.identifier||a.externalId===b.userId);return{id:c?._id||b.userId,name:b.firstName&&b.lastName?`${b.firstName} ${b.lastName}`.trim():b.identifier||"Unknown User",email:b.identifier||"",image:b.imageUrl||"",convexUserId:c?._id}}).filter(a=>null!==a)||[];(0,c.useEffect)(()=>{let a=new Map(C),b=!1;A.forEach(c=>{if(c.file.type.startsWith("image/")&&!a.has(c.tempId)){let d=URL.createObjectURL(c.file);a.set(c.tempId,d),b=!0}});let c=new Set(A.map(a=>a.tempId));return Array.from(a.keys()).forEach(d=>{if(!c.has(d)){let c=a.get(d);c&&(URL.revokeObjectURL(c),a.delete(d),b=!0)}}),b&&D(a),()=>{a.forEach(a=>{URL.revokeObjectURL(a)})}},[A]);let N=M.filter(a=>a.name.toLowerCase().includes(w.toLowerCase())),O=()=>E.current&&E.current.textContent||"",P=()=>{let a=window.getSelection();if(!a||0===a.rangeCount)return 0;let b=a.getRangeAt(0),c=b.cloneRange();return c.selectNodeContents(E.current),c.setEnd(b.endContainer,b.endOffset),c.toString().length},Q=async a=>{let b=a.target.files;if(!b||0===b.length)return;let c=Array.from(b).map(a=>{let b=crypto.randomUUID();return a.size>0xa00000?{tempId:b,file:a,uploading:!1,error:"File size exceeds 10MB limit"}:{tempId:b,file:a,uploading:!1,error:void 0}}).filter(a=>!a.error);for(let a of(B(a=>[...a,...c]),c)){let{tempId:b}=a;B(a=>a.map(a=>a.tempId===b?{...a,uploading:!0}:a));try{let c=await L(),d=await fetch(c,{method:"POST",headers:{"Content-Type":a.file.type},body:a.file});if(!d.ok)throw Error("Upload failed");let{storageId:e}=await d.json();B(a=>a.map(a=>a.tempId===b?{...a,uploading:!1,storageId:e}:a))}catch(a){console.error("File upload error:",a),B(a=>a.map(a=>a.tempId===b?{...a,uploading:!1,error:"Upload failed"}:a))}}F.current&&(F.current.value="")},R=a=>{B(b=>b.filter(b=>b.tempId!==a))},S=async()=>{if(!s.trim())return void G.error("Error","Please enter a message");if(A.some(a=>a.uploading))return void G.error("Error","Please wait for files to finish uploading");if(A.some(a=>a.error))return void G.error("Error","Please remove files with errors");try{let b=A.filter(a=>a.storageId).map(a=>({storageId:a.storageId,fileName:a.file.name,fileSize:a.file.size,mimeType:a.file.type}));if(0===y.length)return void G.error("No recipients","Please @mention a team member to notify them about this message");for(let c of y){let d=M.find(a=>a.convexUserId===c.id||a.id===c.id);if(!d)continue;let e=d.convexUserId;e||(e=await K({clerkUserId:d.id,name:d.name,email:d.email,imageUrl:d.image})),await J({taggedUserId:e,message:s,entityType:a,entityId:p,entityName:q,attachments:b.length>0?b:void 0})}E.current&&(E.current.textContent=""),t(""),z([]),C.forEach(a=>{URL.revokeObjectURL(a)}),D(new Map),B([]),G.success("Success","Message sent!"),r?.()}catch(b){let a=b instanceof Error?b.message:"Failed to send message";G.error("Error",a)}};return(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)(i.Popover,{open:u&&N.length>0,onOpenChange:a=>{a||v(!1)},children:[(0,b.jsx)(i.PopoverTrigger,{asChild:!0,children:(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)("div",{ref:E,contentEditable:!0,onInput:()=>{let a=O();t(a);let b=P(),c=a.slice(0,b),d=c.lastIndexOf("@");if(-1!==d){let a=c.slice(d+1),b=c.lastIndexOf("@["),e=c.lastIndexOf("]");-1!==b&&!(e>b)||a.includes(" ")||a.includes("[")||a.includes("]")?v(!1):(x(a),v(!0))}else v(!1)},className:"min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 overflow-auto whitespace-pre-wrap break-words empty:before:content-[attr(data-placeholder)] empty:before:text-muted-foreground",style:{minHeight:"100px"},suppressContentEditableWarning:!0,"data-placeholder":"Type @ to mention a team member..."})})}),(0,b.jsx)(i.PopoverContent,{align:"start",side:"bottom",className:"w-80 p-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700",onOpenAutoFocus:a=>a.preventDefault(),children:(0,b.jsx)("div",{className:"max-h-64 overflow-y-auto",children:N.map(a=>{var c;let d;return(0,b.jsxs)("button",{onClick:()=>((a,b,c)=>{let d=O(),e=P(),f=d.slice(0,e).lastIndexOf("@");if(-1!==f&&E.current){let g=d.slice(0,f),h=d.slice(e),i=`${g}@[${b}]${h}`,j=c||a;z(a=>[...a,{id:j,name:b}]),E.current.textContent=i,t(i),v(!1);let k=f+b.length+3,l=window.getSelection(),m=document.createRange(),n=E.current.firstChild;n&&n.nodeType===Node.TEXT_NODE&&(m.setStart(n,Math.min(k,n.textContent?.length||0)),m.collapse(!0),l?.removeAllRanges(),l?.addRange(m)),E.current.focus()}})(a.id,a.name,a.convexUserId),className:"w-full flex items-center gap-3 px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md transition-colors text-left",children:[(0,b.jsxs)(h.Avatar,{className:"h-8 w-8",children:[(0,b.jsx)(h.AvatarImage,{src:a.image,alt:a.name}),(0,b.jsx)(h.AvatarFallback,{className:"text-xs",children:(d=(c=a.name).split(" ")).length>=2?`${d[0][0]}${d[1][0]}`.toUpperCase():c.slice(0,2).toUpperCase()})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:a.email})]})]},a.id)})})})]}),A.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:A.map(a=>{let c=a.file.type.startsWith("image/"),d="application/pdf"===a.file.type;return(0,b.jsx)("div",{className:"relative inline-block group",children:c?(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"h-20 w-20 bg-gray-100 dark:bg-gray-800 rounded-lg border-2 border-gray-200 dark:border-gray-700 overflow-hidden flex items-center justify-center",children:a.uploading?(0,b.jsx)(o.Loader2,{className:"h-6 w-6 text-gray-400 animate-spin"}):(0,b.jsx)("img",{src:C.get(a.tempId)||"",alt:a.file.name,className:"h-full w-full object-cover"})}),!a.uploading&&!a.error&&(0,b.jsx)("button",{onClick:()=>R(a.tempId),className:"absolute -top-2 -right-2 p-1 bg-red-500 hover:bg-red-600 text-white rounded-full shadow-lg transition-colors",type:"button",title:"Remove",children:(0,b.jsx)(m.X,{className:"h-3 w-3"})}),a.error&&(0,b.jsx)("div",{className:"absolute inset-0 bg-red-500/90 rounded-lg flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xs text-white font-medium px-2 text-center",children:"Error"})})]}):(0,b.jsxs)("div",{className:"inline-flex items-center gap-1.5 px-2.5 py-1.5 bg-gray-100 dark:bg-gray-800 rounded-md border border-gray-200 dark:border-gray-700 transition-colors max-w-[200px]",children:[(0,b.jsx)(n.FileIcon,{className:`h-3.5 w-3.5 shrink-0 ${d?"text-red-500":"text-gray-500"}`}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 truncate block",children:a.file.name}),(0,b.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(a=>{if(0===a)return"0 Bytes";let b=Math.floor(Math.log(a)/Math.log(1024));return Math.round(a/Math.pow(1024,b)*100)/100+" "+["Bytes","KB","MB"][b]})(a.file.size),a.uploading&&" • Uploading..."]})]}),a.uploading?(0,b.jsx)(o.Loader2,{className:"h-3 w-3 text-gray-400 animate-spin shrink-0"}):a.error?(0,b.jsx)("span",{className:"text-xs text-red-500 shrink-0",children:"✕"}):(0,b.jsx)("button",{onClick:()=>R(a.tempId),className:"p-0.5 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors shrink-0",type:"button",title:"Remove",children:(0,b.jsx)(m.X,{className:"h-3 w-3 text-gray-500"})})]})},a.tempId)})}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:y.length>0?(0,b.jsxs)("span",{children:["Mentioning:"," ",(0,b.jsx)("strong",{children:y.map(a=>a.name).join(", ")})]}):(0,b.jsx)("span",{children:"Type @ to mention someone"})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{ref:F,type:"file",multiple:!0,className:"hidden",onChange:Q,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv,.zip"}),(0,b.jsx)(g.StyledButton,{onClick:()=>F.current?.click(),size:"sm",intent:"outline",icon:(0,b.jsx)(l.Paperclip,{className:"h-4 w-4"}),showArrow:!1,type:"button"}),(0,b.jsx)(g.StyledButton,{onClick:S,disabled:!s.trim()||A.some(a=>a.uploading||a.error),size:"sm",intent:"primary",icon:(0,b.jsx)(k.Send,{className:"h-4 w-4"}),label:"Send",showArrow:!1})]})]})]})}var q=a.i(968177),r=a.i(135773);let s=(0,a.i(170106).default)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);a.s(["MessageSquare",()=>s],563588);var t=a.i(284505),u=a.i(571987);function v({notificationId:a}){let c=(0,d.useQuery)(f.api.messageAttachments.listByNotificationWithUrls,{notificationId:a});if(!c||0===c.length)return null;let e=a=>{if(0===a)return"0 Bytes";let b=["Bytes","KB","MB","GB","TB","PB"],c=Math.min(Math.floor(Math.log(a)/Math.log(1024)),b.length-1);return Math.round(a/Math.pow(1024,c)*100)/100+" "+b[c]},g=a=>a.startsWith("image/");return(0,b.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:c.map(a=>(0,b.jsx)(w,{attachment:a,downloadUrl:a.downloadUrl,formatFileSize:e,isImage:g},a._id))})}function w({attachment:a,downloadUrl:c,formatFileSize:d,isImage:e}){if(!c)return null;let f="application/pdf"===a.mimeType;return e(a.mimeType)?(0,b.jsxs)("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"group relative inline-block",title:`${a.fileName} (${d(a.fileSize)})`,children:[(0,b.jsx)(u.default,{src:c,alt:a.fileName,width:80,height:80,className:"h-20 w-20 object-cover rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 transition-colors"}),(0,b.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 rounded-lg transition-colors flex items-center justify-center",children:(0,b.jsx)(t.Download,{className:"h-4 w-4 text-white opacity-0 group-hover:opacity-100 transition-opacity drop-shadow-lg"})})]}):(0,b.jsxs)("a",{href:c,target:"_blank",rel:"noopener noreferrer",download:a.fileName,className:"inline-flex items-center gap-1.5 px-2.5 py-1.5 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md border border-gray-200 dark:border-gray-700 transition-colors group max-w-[200px]",title:`${a.fileName} (${d(a.fileSize)})`,children:[f?(0,b.jsx)(n.FileIcon,{className:"h-3.5 w-3.5 text-red-500 shrink-0"}):(0,b.jsx)(n.FileIcon,{className:"h-3.5 w-3.5 text-gray-500 shrink-0"}),(0,b.jsx)("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 truncate",children:a.fileName}),(0,b.jsx)(t.Download,{className:"h-3 w-3 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 shrink-0 ml-auto"})]})}function x({entityType:a,entityId:c}){let e=(0,d.useQuery)(f.api.notifications.listByEntity,{entityType:a,entityId:c});return void 0===e?(0,b.jsx)("div",{className:"space-y-4 animate-pulse",children:[1,2,3].map(a=>(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"}),(0,b.jsx)("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"})]})]},a))}):0===e.length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4",children:(0,b.jsx)(s,{className:"h-8 w-8 text-gray-400 dark:text-gray-600"})}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No messages yet"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-sm",children:"Start a conversation by mentioning a team member with @ in the input above."})]}):(0,b.jsx)("div",{className:"space-y-6",children:e.map(a=>{var c;let d;return(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)(h.Avatar,{className:"h-10 w-10 shrink-0",children:[(0,b.jsx)(h.AvatarImage,{src:a.author?.image,alt:a.author?.name||a.author?.email||"User"}),(0,b.jsx)(h.AvatarFallback,{className:"text-sm",children:a.author?.name?(d=(c=a.author.name).split(" ")).length>=2?`${d[0][0]}${d[1][0]}`.toUpperCase():c.slice(0,2).toUpperCase():a.author?.email?a.author.email.substring(0,2).toUpperCase():"??"})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:a.author?.name||a.author?.email||"Unknown User"}),(0,b.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:(0,r.formatRelativeTime)(a._creationTime)})]}),(0,b.jsx)("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg px-4 py-3 border border-gray-200 dark:border-gray-700",children:(0,b.jsx)("div",{className:"text-sm text-gray-900 dark:text-white whitespace-pre-wrap break-words",children:(0,r.parseMessageParts)(a.message).map((a,c)=>a.isMention?(0,b.jsx)(q.Badge,{variant:"secondary",className:"inline-flex mx-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-900/50 font-medium",children:a.text},c):(0,b.jsx)("span",{children:a.text},c))})}),a.hasAttachments&&(0,b.jsx)(v,{notificationId:a._id})]})]},a._id)})})}a.i(501786);var y=a.i(184394);function z({entityType:a,entityId:d,entityName:e}){let[f,g]=(0,c.useState)(0);return(0,b.jsxs)(y.StyledCard,{children:[(0,b.jsxs)(y.StyledCardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(s,{className:"h-5 w-5 text-primary"}),(0,b.jsx)(y.StyledCardTitle,{className:"text-lg",children:"Team Communication"})]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Mention team members to notify them about this ",a]})]}),(0,b.jsxs)(y.StyledCardContent,{className:"space-y-6",children:[(0,b.jsx)("div",{className:"pb-6 border-b border-gray-200 dark:border-gray-700",children:(0,b.jsx)(p,{entityType:a,entityId:d,entityName:e,onMentionCreated:()=>{g(a=>a+1)}})}),(0,b.jsx)("div",{children:(0,b.jsx)(x,{entityType:a,entityId:d})},f)]})]})}a.s(["MentionSection",()=>z],527415)}];

//# sourceMappingURL=_935b9564._.js.map