{"version":3,"sources":["../../../../../../node_modules/%40clerk/nextjs/src/server/keyless-log-cache.ts"],"sourcesContent":["import type { AccountlessApplication } from '@clerk/backend';\nimport { isDevelopmentEnvironment } from '@clerk/shared/utils';\n// 10 minutes in milliseconds\nconst THROTTLE_DURATION_MS = 10 * 60 * 1000;\n\nfunction createClerkDevCache() {\n  if (!isDevelopmentEnvironment()) {\n    return;\n  }\n\n  if (!global.__clerk_internal_keyless_logger) {\n    global.__clerk_internal_keyless_logger = {\n      __cache: new Map<string, { expiresAt: number; data?: unknown }>(),\n\n      log: function ({ cacheKey, msg }) {\n        if (this.__cache.has(cacheKey) && Date.now() < (this.__cache.get(cacheKey)?.expiresAt || 0)) {\n          return;\n        }\n\n        console.log(msg);\n\n        this.__cache.set(cacheKey, {\n          expiresAt: Date.now() + THROTTLE_DURATION_MS,\n        });\n      },\n      run: async function (\n        callback,\n        { cacheKey, onSuccessStale = THROTTLE_DURATION_MS, onErrorStale = THROTTLE_DURATION_MS },\n      ) {\n        if (this.__cache.has(cacheKey) && Date.now() < (this.__cache.get(cacheKey)?.expiresAt || 0)) {\n          return this.__cache.get(cacheKey)?.data;\n        }\n\n        try {\n          const result = await callback();\n\n          this.__cache.set(cacheKey, {\n            expiresAt: Date.now() + onSuccessStale,\n            data: result,\n          });\n          return result;\n        } catch (e) {\n          this.__cache.set(cacheKey, {\n            expiresAt: Date.now() + onErrorStale,\n          });\n\n          throw e;\n        }\n      },\n    };\n  }\n\n  return globalThis.__clerk_internal_keyless_logger;\n}\n\nexport const createKeylessModeMessage = (keys: AccountlessApplication) => {\n  return `\\n\\x1b[35m\\n[Clerk]:\\x1b[0m You are running in keyless mode.\\nYou can \\x1b[35mclaim your keys\\x1b[0m by visiting ${keys.claimUrl}\\n`;\n};\n\nexport const createConfirmationMessage = () => {\n  return `\\n\\x1b[35m\\n[Clerk]:\\x1b[0m Your application is running with your claimed keys.\\nYou can safely remove the \\x1b[35m.clerk/\\x1b[0m from your project.\\n`;\n};\n\nexport const clerkDevelopmentCache = createClerkDevCache();\n"],"names":[],"mappings":"oDACA,IAAA,EAAyC,EAAA,CAAhC,AAAgC,CAAA,QAsDlC,IAAM,EAA2B,AAAC,GAChC,CAAA,KADiE,QAtDjC;;;mDAuDhC,EAAoH,EAAK,QAAQ,CAAA;AAAA,CAAA,CAG7H,EAA4B,IAChC,CAAA,CADsC;;;;AACtC,CAAA,CAGI,EA1Db,AA0DqC,SA1D5B,EACP,GAAI,CAAA,EAAC,EAAA,CAyDkD,WA1D1B,YACxB,CAAyB,GA8C9B,CA9CiC,MAI7B,AAAC,CAAA,CAAA,CAAA,CAAO,+BAAA,EAAiC,AAC3C,CAAA,EAAA,CAAA,CAAO,+BAAA,CAAkC,CACvC,QAAS,CAAA,GAAI,IAAmD,AAEhE,IAAK,EAFI,OAEM,UAAE,CAAA,KAAU,CAAA,CAAI,EAAG,AAdxC,IAAA,EAeY,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,IAAa,IAAL,CAAU,GAAA,CAAI,GAAA,CAAK,AAAL,MAAK,GAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,EAAQ,CAAA,CAAzB,KAAA,EAAA,EAA4B,SAAA,IAAa,CAAA,GAAI,AAI7F,QAAQ,GAAA,CAAI,GAAG,AAEf,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,EAAU,CACzB,UAAW,KAAK,GAAA,CAAI,IAAI,CAC1B,CAAC,EACH,EACA,IAAK,eACH,CAAA,CACA,UAAE,CAAA,gBAAU,KAAiB,YAAA,EAAsB,EAxB9B,GAwB6C,CAAqB,CAxB7D,CAHlC,AA4BQ,IAzB+B,AAHvC,EAAA,CA2B0E,CAElE,GAAI,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,IAAa,IAAL,CAAU,GAAA,CAAI,GAAA,CAAA,AAAK,OAAA,EAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,EAAQ,CAAA,CAAzB,KAAA,EAAA,EAA4B,SAAA,IAAa,CAAA,CACvF,EAD2F,KAC3F,AAAO,OAAA,EAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,EAAQ,CAAA,CAAzB,KAAA,EAAA,EAA4B,IAAA,CAGrC,GAAI,CACF,IAAM,EAAS,MAAM,IAMrB,KAN8B,EAE9B,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,EAAU,CACzB,UAAW,KAAK,GAAA,CAAI,EAAI,EACxB,KAAM,CACR,CAAC,EACM,CACT,CAAA,MAAS,EAAG,CAKV,MAJA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,EAAU,CACzB,UAAW,KAAK,GAAA,CAAI,EAAI,CAC1B,CAAC,EAEK,CACR,CACF,EACF,EAGK,WAAW,+BAAA,AACpB"}