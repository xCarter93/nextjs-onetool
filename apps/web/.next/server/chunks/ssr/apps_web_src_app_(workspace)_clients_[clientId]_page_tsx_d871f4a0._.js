module.exports=[415887,a=>{"use strict";var b,c=a.i(187924),d=a.i(50944);a.i(511241);var e=a.i(296373),f=a.i(130487),g=a.i(629353),h=a.i(452309),i=a.i(572131);let j=i.forwardRef(function({title:a,titleId:b,...c},d){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":b},c),a?i.createElement("title",{id:b},a):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}),k=i.forwardRef(function({title:a,titleId:b,...c},d){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":b},c),a?i.createElement("title",{id:b},a):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75"}))});var l=a.i(533441),m=a.i(360031);a.i(501786);var n=a.i(184394),o=a.i(948217),p=a.i(539524),q=a.i(928503),r=a.i(468106);let s=i.forwardRef(function({title:a,titleId:b,...c},d){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":b},c),a?i.createElement("title",{id:b},a):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Z"}))}),t=i.forwardRef(function({title:a,titleId:b,...c},d){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":b},c),a?i.createElement("title",{id:b},a):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))});var u=a.i(39267),v=a.i(703471),w=a.i(981115),x=a.i(89329);let y=i.forwardRef(function({title:a,titleId:b,...c},d){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":b},c),a?i.createElement("title",{id:b},a):null,i.createElement("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z",clipRule:"evenodd"}))});function z({clientId:a,properties:b,onChange:d}){let h=(0,g.useToast)(),j=(0,e.useMutation)(f.api.clientProperties.create),k=(0,e.useMutation)(f.api.clientProperties.update),l=(0,e.useMutation)(f.api.clientProperties.remove),[m,q]=(0,i.useState)(null),[r,u]=(0,i.useState)([]),[v,w]=(0,i.useState)(1),x=(0,i.useMemo)(()=>{let a=b.map(a=>({...a,isNew:!1}));return console.log("allProperties useMemo:",{savedItems:a.map(a=>({id:a._id,name:a.streetAddress,isNew:a.isNew})),localProperties:r.map(a=>({id:a._id,name:a.streetAddress,isNew:a.isNew}))}),[...a,...r]},[b,r]),y=async b=>{if(console.log("handleSaveProperty called with:",{propertyId:b._id,propertyIdType:typeof b._id,isNew:b.isNew}),b.isNew||"string"==typeof b._id&&b._id.startsWith("temp-")){console.log("Creating new property...");try{await j({clientId:a,streetAddress:b.streetAddress||"Address Required",city:b.city||"City Required",state:b.state||"State Required",zipCode:b.zipCode||"ZIP Required",country:b.country,description:b.description,isPrimary:b.isPrimary}),u(a=>a.filter(a=>a._id!==b._id)),q(null),d?.(),h.success("Property Saved","Property has been successfully saved!")}catch(a){console.error("Failed to save property:",a),h.error("Error","Failed to save property. Please try again.")}}else{console.log("Updating existing property with ID:",b._id);try{await k({id:b._id,streetAddress:b.streetAddress,city:b.city,state:b.state,zipCode:b.zipCode,country:b.country,description:b.description,isPrimary:b.isPrimary}),q(null),d?.(),h.success("Property Updated","Property has been successfully updated!")}catch(a){console.error("Failed to save property:",a),h.error("Error","Failed to save property. Please try again.")}}},z=async a=>{if("string"==typeof a&&a.startsWith("temp-"))u(b=>b.filter(b=>b._id!==a)),m===a&&q(null),h.success("Property Deleted","Unsaved property has been removed.");else try{await l({id:a}),d?.(),h.success("Property Deleted","Property has been successfully deleted.")}catch(a){console.error("Failed to delete property:",a),h.error("Error","Failed to delete property. Please try again.")}};return(0,c.jsxs)(n.StyledCard,{children:[(0,c.jsxs)(n.StyledCardHeader,{className:"flex flex-row items-center justify-between pb-6",children:[(0,c.jsx)(n.StyledCardTitle,{className:"text-xl",children:"Properties"}),(0,c.jsxs)(p.Button,{intent:"outline",size:"sm",onPress:()=>{let a=`temp-${v}`,b={_id:a,streetAddress:"",city:"",state:"",zipCode:"",country:"",description:"",isPrimary:!1,isNew:!0};u(a=>[...a,b]),q(a),w(a=>a+1)},children:[(0,c.jsx)(t,{className:"h-4 w-4 mr-2"}),"New Property"]})]}),(0,c.jsx)(n.StyledCardContent,{children:x&&x.length>0?(0,c.jsx)("div",{className:"overflow-hidden rounded-lg border",children:(0,c.jsxs)(o.Table,{children:[(0,c.jsx)(o.TableHeader,{children:(0,c.jsxs)(o.TableRow,{children:[(0,c.jsx)(o.TableHead,{className:"w-[40%]",children:"Address"}),(0,c.jsx)(o.TableHead,{className:"w-[20%]",children:"City"}),(0,c.jsx)(o.TableHead,{className:"w-[15%]",children:"State"}),(0,c.jsx)(o.TableHead,{className:"w-[15%]",children:"ZIP"}),(0,c.jsx)(o.TableHead,{className:"w-[5%]",children:"Primary"}),(0,c.jsx)(o.TableHead,{className:"w-[5%]",children:"Actions"})]})}),(0,c.jsx)(o.TableBody,{children:x.map(a=>(0,c.jsx)(A,{property:a,isEditing:m===a._id,onEdit:()=>{var b;console.log("handleEditProperty called with:",{id:b=a._id,idType:typeof b,property:x.find(a=>a._id===b)}),q(b)},onSave:y,onCancel:()=>q(null),onDelete:()=>z(a._id)},a._id))})]})}):(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,c.jsx)("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center mb-4",children:(0,c.jsx)(s,{className:"h-8 w-8 text-gray-400"})}),(0,c.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No properties"}),(0,c.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No properties have been added for this client yet."})]})})]})}function A({property:a,isEditing:b,onEdit:d,onSave:e,onCancel:f,onDelete:g}){let[h,j]=(0,i.useState)(a);i.default.useEffect(()=>{b&&j(a)},[b,a]);let k=(a,b)=>{j(c=>({...c,[a]:b}))};return b?(0,c.jsxs)(o.TableRow,{className:`bg-blue-50/50 dark:bg-blue-900/10 border-l-4 border-l-blue-500 ${a.isNew?"bg-yellow-50/50 dark:bg-yellow-900/10":""}`,children:[(0,c.jsx)(o.TableCell,{children:(0,c.jsx)(q.Input,{value:h.streetAddress,onChange:a=>k("streetAddress",a.target.value),placeholder:"Street address...",className:"w-full"})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsx)(q.Input,{value:h.city,onChange:a=>k("city",a.target.value),placeholder:"City...",className:"w-full"})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsx)(q.Input,{value:h.state,onChange:a=>k("state",a.target.value),placeholder:"State...",className:"w-full"})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsx)(q.Input,{value:h.zipCode,onChange:a=>k("zipCode",a.target.value),placeholder:"ZIP...",className:"w-full"})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsx)(r.Checkbox,{checked:h.isPrimary,onCheckedChange:a=>k("isPrimary",!!a)})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsxs)("div",{className:"flex gap-1",children:[(0,c.jsx)(p.Button,{intent:"outline",size:"sq-sm",onPress:()=>{console.log("PropertyRow handleSave called with:",{propertyId:h._id,propertyIdType:typeof h._id,isNew:h.isNew,originalPropertyId:a._id,originalPropertyIdType:typeof a._id}),e(h)},"aria-label":"Save",children:(0,c.jsx)(w.CheckIcon,{className:"h-3 w-3"})}),(0,c.jsx)(p.Button,{intent:"outline",size:"sq-sm",onPress:f,"aria-label":"Cancel",children:(0,c.jsx)(x.XMarkIcon,{className:"h-3 w-3"})})]})})]}):(0,c.jsxs)(o.TableRow,{className:`hover:bg-muted/50 ${a.isNew?"bg-yellow-50/30 dark:bg-yellow-900/20 border-l-4 border-l-yellow-400":""}`,children:[(0,c.jsx)(o.TableCell,{className:"font-medium",children:(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("span",{children:a.streetAddress}),a.isNew&&(0,c.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:"Unsaved"})]})}),(0,c.jsx)(o.TableCell,{children:a.city}),(0,c.jsx)(o.TableCell,{children:a.state}),(0,c.jsx)(o.TableCell,{children:a.zipCode}),(0,c.jsx)(o.TableCell,{children:a.isPrimary&&(0,c.jsx)(y,{className:"h-4 w-4 text-yellow-400"})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsxs)("div",{className:"flex gap-1",children:[(0,c.jsx)(p.Button,{intent:"outline",size:"sq-sm",onPress:d,"aria-label":"Edit",children:(0,c.jsx)(u.PencilIcon,{className:"h-3 w-3"})}),(0,c.jsx)(p.Button,{intent:"outline",size:"sq-sm",onPress:g,"aria-label":"Delete",children:(0,c.jsx)(v.TrashIcon,{className:"h-3 w-3"})})]})})]})}function B({clientId:a,contacts:b,onChange:d}){let h=(0,g.useToast)(),j=(0,e.useMutation)(f.api.clientContacts.create),l=(0,e.useMutation)(f.api.clientContacts.update),m=(0,e.useMutation)(f.api.clientContacts.remove),[q,r]=(0,i.useState)(null),[s,u]=(0,i.useState)([]),[v,w]=(0,i.useState)(1),x=(0,i.useMemo)(()=>{let a=b.map(a=>({...a,isNew:!1}));return console.log("allContacts useMemo:",{savedItems:a.map(a=>({id:a._id,name:`${a.firstName} ${a.lastName}`,isNew:a.isNew})),localContacts:s.map(a=>({id:a._id,name:`${a.firstName} ${a.lastName}`,isNew:a.isNew}))}),[...a,...s]},[b,s]),y=async b=>{if(console.log("handleSaveContact called with:",{contactId:b._id,contactIdType:typeof b._id,isNew:b.isNew,contactName:`${b.firstName} ${b.lastName}`}),b.isNew||"string"==typeof b._id&&b._id.startsWith("temp-")){console.log("Creating new contact...");try{await j({clientId:a,firstName:b.firstName||"First Name Required",lastName:b.lastName||"Last Name Required",email:b.email,phone:b.phone,jobTitle:b.jobTitle,role:b.role,isPrimary:b.isPrimary}),u(a=>a.filter(a=>a._id!==b._id)),r(null),d?.(),h.success("Contact Saved","Contact has been successfully saved!")}catch(a){console.error("Failed to save contact:",a),h.error("Error","Failed to save contact. Please try again.")}}else{console.log("Updating existing contact with ID:",b._id);try{await l({id:b._id,firstName:b.firstName,lastName:b.lastName,email:b.email,phone:b.phone,jobTitle:b.jobTitle,role:b.role,isPrimary:b.isPrimary}),r(null),d?.(),h.success("Contact Updated","Contact has been successfully updated!")}catch(a){console.error("Failed to save contact:",a),h.error("Error","Failed to save contact. Please try again.")}}},z=async a=>{if("string"==typeof a&&a.startsWith("temp-"))u(b=>b.filter(b=>b._id!==a)),q===a&&r(null),h.success("Contact Deleted","Unsaved contact has been removed.");else try{await m({id:a}),d?.(),h.success("Contact Deleted","Contact has been successfully deleted.")}catch(a){console.error("Failed to delete contact:",a),h.error("Error","Failed to delete contact. Please try again.")}};return(0,c.jsxs)(n.StyledCard,{children:[(0,c.jsxs)(n.StyledCardHeader,{className:"flex flex-row items-center justify-between pb-6",children:[(0,c.jsx)(n.StyledCardTitle,{className:"text-xl",children:"Contacts"}),(0,c.jsxs)(p.Button,{intent:"outline",size:"sm",onPress:()=>{let a=`temp-${v}`,b={_id:a,firstName:"",lastName:"",email:"",phone:"",jobTitle:"",role:"",isPrimary:!1,isNew:!0};u(a=>[...a,b]),r(a),w(a=>a+1)},children:[(0,c.jsx)(t,{className:"h-4 w-4 mr-2"}),"New Contact"]})]}),(0,c.jsx)(n.StyledCardContent,{children:x&&x.length>0?(0,c.jsx)("div",{className:"overflow-hidden rounded-lg border",children:(0,c.jsxs)(o.Table,{children:[(0,c.jsx)(o.TableHeader,{children:(0,c.jsxs)(o.TableRow,{children:[(0,c.jsx)(o.TableHead,{className:"w-[25%]",children:"Name"}),(0,c.jsx)(o.TableHead,{className:"w-[25%]",children:"Job Title"}),(0,c.jsx)(o.TableHead,{className:"w-[20%]",children:"Phone"}),(0,c.jsx)(o.TableHead,{className:"w-[20%]",children:"Email"}),(0,c.jsx)(o.TableHead,{className:"w-[5%]",children:"Primary"}),(0,c.jsx)(o.TableHead,{className:"w-[5%]",children:"Actions"})]})}),(0,c.jsx)(o.TableBody,{children:x.map(a=>(0,c.jsx)(C,{contact:a,isEditing:q===a._id,onEdit:()=>{var b;console.log("handleEditContact called with:",{id:b=a._id,idType:typeof b,contact:x.find(a=>a._id===b)}),r(b)},onSave:y,onCancel:()=>r(null),onDelete:()=>z(a._id)},a._id))})]})}):(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,c.jsx)("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center mb-4",children:(0,c.jsx)(k,{className:"h-8 w-8 text-gray-400"})}),(0,c.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No contacts"}),(0,c.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No contacts have been added for this client yet."})]})})]})}function C({contact:a,isEditing:b,onEdit:d,onSave:e,onCancel:f,onDelete:g}){let[h,j]=(0,i.useState)(a);i.default.useEffect(()=>{b&&j(a)},[b,a]);let k=(a,b)=>{j(c=>({...c,[a]:b}))};return b?(0,c.jsxs)(o.TableRow,{className:`bg-blue-50/50 dark:bg-blue-900/10 border-l-4 border-l-blue-500 ${a.isNew?"bg-yellow-50/50 dark:bg-yellow-900/10":""}`,children:[(0,c.jsx)(o.TableCell,{children:(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsx)(q.Input,{value:h.firstName,onChange:a=>k("firstName",a.target.value),placeholder:"First name...",className:"w-full"}),(0,c.jsx)(q.Input,{value:h.lastName,onChange:a=>k("lastName",a.target.value),placeholder:"Last name...",className:"w-full"})]})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsx)("div",{className:"space-y-2",children:(0,c.jsx)(q.Input,{value:h.jobTitle||"",onChange:a=>k("jobTitle",a.target.value),placeholder:"Job title...",className:"w-full"})})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsx)(q.Input,{value:h.phone||"",onChange:a=>k("phone",a.target.value),placeholder:"Phone...",className:"w-full"})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsx)(q.Input,{value:h.email||"",onChange:a=>k("email",a.target.value),placeholder:"Email...",className:"w-full",type:"email"})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsx)(r.Checkbox,{checked:h.isPrimary,onCheckedChange:a=>k("isPrimary",!!a)})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsxs)("div",{className:"flex gap-1",children:[(0,c.jsx)(p.Button,{intent:"outline",size:"sq-sm",onPress:()=>{console.log("ContactRow handleSave called with:",{contactId:h._id,contactIdType:typeof h._id,isNew:h.isNew,originalContactId:a._id,originalContactIdType:typeof a._id}),e(h)},"aria-label":"Save",children:(0,c.jsx)(w.CheckIcon,{className:"h-3 w-3"})}),(0,c.jsx)(p.Button,{intent:"outline",size:"sq-sm",onPress:f,"aria-label":"Cancel",children:(0,c.jsx)(x.XMarkIcon,{className:"h-3 w-3"})})]})})]}):(0,c.jsxs)(o.TableRow,{className:`hover:bg-muted/50 ${a.isNew?"bg-yellow-50/30 dark:bg-yellow-900/20 border-l-4 border-l-yellow-400":""}`,children:[(0,c.jsx)(o.TableCell,{className:"font-medium",children:(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsxs)("span",{children:[a.firstName," ",a.lastName]}),a.isNew&&(0,c.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:"Unsaved"})]})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsx)("div",{children:a.jobTitle&&(0,c.jsx)("p",{className:"font-medium",children:a.jobTitle})})}),(0,c.jsx)(o.TableCell,{children:a.phone||"—"}),(0,c.jsx)(o.TableCell,{children:a.email||"—"}),(0,c.jsx)(o.TableCell,{children:a.isPrimary&&(0,c.jsx)(y,{className:"h-4 w-4 text-yellow-400"})}),(0,c.jsx)(o.TableCell,{children:(0,c.jsxs)("div",{className:"flex gap-1",children:[(0,c.jsx)(p.Button,{intent:"outline",size:"sq-sm",onPress:d,"aria-label":"Edit",children:(0,c.jsx)(u.PencilIcon,{className:"h-3 w-3"})}),(0,c.jsx)(p.Button,{intent:"outline",size:"sq-sm",onPress:g,"aria-label":"Delete",children:(0,c.jsx)(v.TrashIcon,{className:"h-3 w-3"})})]})})]})}var D=a.i(770137),E=a.i(527415);let{entries:F,setPrototypeOf:G,isFrozen:H,getPrototypeOf:I,getOwnPropertyDescriptor:J}=Object,{freeze:K,seal:L,create:M}=Object,{apply:N,construct:O}="undefined"!=typeof Reflect&&Reflect;K||(K=function(a){return a}),L||(L=function(a){return a}),N||(N=function(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;e<c;e++)d[e-2]=arguments[e];return a.apply(b,d)}),O||(O=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return new a(...c)});let P=ab(Array.prototype.forEach),Q=ab(Array.prototype.lastIndexOf),R=ab(Array.prototype.pop),S=ab(Array.prototype.push),T=ab(Array.prototype.splice),U=ab(String.prototype.toLowerCase),V=ab(String.prototype.toString),W=ab(String.prototype.match),X=ab(String.prototype.replace),Y=ab(String.prototype.indexOf),Z=ab(String.prototype.trim),$=ab(Object.prototype.hasOwnProperty),_=ab(RegExp.prototype.test),aa=(b=TypeError,function(){for(var a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];return O(b,c)});function ab(a){return function(b){b instanceof RegExp&&(b.lastIndex=0);for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return N(a,b,d)}}function ac(a,b){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U;G&&G(a,null);let d=b.length;for(;d--;){let e=b[d];if("string"==typeof e){let a=c(e);a!==e&&(H(b)||(b[d]=a),e=a)}a[e]=!0}return a}function ad(a){let b=M(null);for(let[c,d]of F(a))$(a,c)&&(Array.isArray(d)?b[c]=function(a){for(let b=0;b<a.length;b++)$(a,b)||(a[b]=null);return a}(d):d&&"object"==typeof d&&d.constructor===Object?b[c]=ad(d):b[c]=d);return b}function ae(a,b){for(;null!==a;){let c=J(a,b);if(c){if(c.get)return ab(c.get);if("function"==typeof c.value)return ab(c.value)}a=I(a)}return function(){return null}}let af=K(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ag=K(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ah=K(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ai=K(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),aj=K(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),ak=K(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),al=K(["#text"]),am=K(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),an=K(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ao=K(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ap=K(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),aq=L(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ar=L(/<%[\w\W]*|[\w\W]*%>/gm),as=L(/\$\{[\w\W]*/gm),at=L(/^data-[\-\w.\u00B7-\uFFFF]+$/),au=L(/^aria-[\-\w]+$/),av=L(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),aw=L(/^(?:\w+script|data):/i),ax=L(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ay=L(/^html$/i);var az=Object.freeze({__proto__:null,ARIA_ATTR:au,ATTR_WHITESPACE:ax,CUSTOM_ELEMENT:L(/^[a-z][.\w]*(-[.\w]+)+$/i),DATA_ATTR:at,DOCTYPE_NAME:ay,ERB_EXPR:ar,IS_ALLOWED_URI:av,IS_SCRIPT_OR_DATA:aw,MUSTACHE_EXPR:aq,TMPLIT_EXPR:as});let aA=function(a,b){if("object"!=typeof a||"function"!=typeof a.createPolicy)return null;let c=null,d="data-tt-policy-suffix";b&&b.hasAttribute(d)&&(c=b.getAttribute(d));let e="dompurify"+(c?"#"+c:"");try{return a.createPolicy(e,{createHTML:a=>a,createScriptURL:a=>a})}catch(a){return console.warn("TrustedTypes policy "+e+" could not be created."),null}},aB=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};var aC=function a(){let b,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=b=>a(b);if(d.version="3.3.1",d.removed=[],!c||!c.document||9!==c.document.nodeType||!c.Element)return d.isSupported=!1,d;let{document:e}=c,f=e,g=f.currentScript,{DocumentFragment:h,HTMLTemplateElement:i,Node:j,Element:k,NodeFilter:l,NamedNodeMap:m=c.NamedNodeMap||c.MozNamedAttrMap,HTMLFormElement:n,DOMParser:o,trustedTypes:p}=c,q=k.prototype,r=ae(q,"cloneNode"),s=ae(q,"remove"),t=ae(q,"nextSibling"),u=ae(q,"childNodes"),v=ae(q,"parentNode");if("function"==typeof i){let a=e.createElement("template");a.content&&a.content.ownerDocument&&(e=a.content.ownerDocument)}let w="",{implementation:x,createNodeIterator:y,createDocumentFragment:z,getElementsByTagName:A}=e,{importNode:B}=f,C=aB();d.isSupported="function"==typeof F&&"function"==typeof v&&x&&void 0!==x.createHTMLDocument;let{MUSTACHE_EXPR:D,ERB_EXPR:E,TMPLIT_EXPR:G,DATA_ATTR:H,ARIA_ATTR:I,IS_SCRIPT_OR_DATA:J,ATTR_WHITESPACE:L,CUSTOM_ELEMENT:N}=az,{IS_ALLOWED_URI:O}=az,ab=null,aq=ac({},[...af,...ag,...ah,...aj,...al]),ar=null,as=ac({},[...am,...an,...ao,...ap]),at=Object.seal(M(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),au=null,aw=null,ax=Object.seal(M(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}})),aC=!0,aD=!0,aE=!1,aF=!0,aG=!1,aH=!0,aI=!1,aJ=!1,aK=!1,aL=!1,aM=!1,aN=!1,aO=!0,aP=!1,aQ=!0,aR=!1,aS={},aT=null,aU=ac({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),aV=null,aW=ac({},["audio","video","img","source","image","track"]),aX=null,aY=ac({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),aZ="http://www.w3.org/1998/Math/MathML",a$="http://www.w3.org/2000/svg",a_="http://www.w3.org/1999/xhtml",a0=a_,a1=!1,a2=null,a3=ac({},[aZ,a$,a_],V),a4=ac({},["mi","mo","mn","ms","mtext"]),a5=ac({},["annotation-xml"]),a6=ac({},["title","style","font","a","script"]),a7=null,a8=["application/xhtml+xml","text/html"],a9=null,ba=null,bb=e.createElement("form"),bc=function(a){return a instanceof RegExp||a instanceof Function},bd=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!ba||ba!==a){if(a&&"object"==typeof a||(a={}),a=ad(a),a9="application/xhtml+xml"===(a7=-1===a8.indexOf(a.PARSER_MEDIA_TYPE)?"text/html":a.PARSER_MEDIA_TYPE)?V:U,ab=$(a,"ALLOWED_TAGS")?ac({},a.ALLOWED_TAGS,a9):aq,ar=$(a,"ALLOWED_ATTR")?ac({},a.ALLOWED_ATTR,a9):as,a2=$(a,"ALLOWED_NAMESPACES")?ac({},a.ALLOWED_NAMESPACES,V):a3,aX=$(a,"ADD_URI_SAFE_ATTR")?ac(ad(aY),a.ADD_URI_SAFE_ATTR,a9):aY,aV=$(a,"ADD_DATA_URI_TAGS")?ac(ad(aW),a.ADD_DATA_URI_TAGS,a9):aW,aT=$(a,"FORBID_CONTENTS")?ac({},a.FORBID_CONTENTS,a9):aU,au=$(a,"FORBID_TAGS")?ac({},a.FORBID_TAGS,a9):ad({}),aw=$(a,"FORBID_ATTR")?ac({},a.FORBID_ATTR,a9):ad({}),aS=!!$(a,"USE_PROFILES")&&a.USE_PROFILES,aC=!1!==a.ALLOW_ARIA_ATTR,aD=!1!==a.ALLOW_DATA_ATTR,aE=a.ALLOW_UNKNOWN_PROTOCOLS||!1,aF=!1!==a.ALLOW_SELF_CLOSE_IN_ATTR,aG=a.SAFE_FOR_TEMPLATES||!1,aH=!1!==a.SAFE_FOR_XML,aI=a.WHOLE_DOCUMENT||!1,aL=a.RETURN_DOM||!1,aM=a.RETURN_DOM_FRAGMENT||!1,aN=a.RETURN_TRUSTED_TYPE||!1,aK=a.FORCE_BODY||!1,aO=!1!==a.SANITIZE_DOM,aP=a.SANITIZE_NAMED_PROPS||!1,aQ=!1!==a.KEEP_CONTENT,aR=a.IN_PLACE||!1,O=a.ALLOWED_URI_REGEXP||av,a0=a.NAMESPACE||a_,a4=a.MATHML_TEXT_INTEGRATION_POINTS||a4,a5=a.HTML_INTEGRATION_POINTS||a5,at=a.CUSTOM_ELEMENT_HANDLING||{},a.CUSTOM_ELEMENT_HANDLING&&bc(a.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(at.tagNameCheck=a.CUSTOM_ELEMENT_HANDLING.tagNameCheck),a.CUSTOM_ELEMENT_HANDLING&&bc(a.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(at.attributeNameCheck=a.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),a.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof a.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(at.allowCustomizedBuiltInElements=a.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),aG&&(aD=!1),aM&&(aL=!0),aS&&(ab=ac({},al),ar=[],!0===aS.html&&(ac(ab,af),ac(ar,am)),!0===aS.svg&&(ac(ab,ag),ac(ar,an),ac(ar,ap)),!0===aS.svgFilters&&(ac(ab,ah),ac(ar,an),ac(ar,ap)),!0===aS.mathMl&&(ac(ab,aj),ac(ar,ao),ac(ar,ap))),a.ADD_TAGS&&("function"==typeof a.ADD_TAGS?ax.tagCheck=a.ADD_TAGS:(ab===aq&&(ab=ad(ab)),ac(ab,a.ADD_TAGS,a9))),a.ADD_ATTR&&("function"==typeof a.ADD_ATTR?ax.attributeCheck=a.ADD_ATTR:(ar===as&&(ar=ad(ar)),ac(ar,a.ADD_ATTR,a9))),a.ADD_URI_SAFE_ATTR&&ac(aX,a.ADD_URI_SAFE_ATTR,a9),a.FORBID_CONTENTS&&(aT===aU&&(aT=ad(aT)),ac(aT,a.FORBID_CONTENTS,a9)),a.ADD_FORBID_CONTENTS&&(aT===aU&&(aT=ad(aT)),ac(aT,a.ADD_FORBID_CONTENTS,a9)),aQ&&(ab["#text"]=!0),aI&&ac(ab,["html","head","body"]),ab.table&&(ac(ab,["tbody"]),delete au.tbody),a.TRUSTED_TYPES_POLICY){if("function"!=typeof a.TRUSTED_TYPES_POLICY.createHTML)throw aa('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof a.TRUSTED_TYPES_POLICY.createScriptURL)throw aa('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=(b=a.TRUSTED_TYPES_POLICY).createHTML("")}else void 0===b&&(b=aA(p,g)),null!==b&&"string"==typeof w&&(w=b.createHTML(""));K&&K(a),ba=a}},be=ac({},[...ag,...ah,...ai]),bf=ac({},[...aj,...ak]),bg=function(a){let b=v(a);b&&b.tagName||(b={namespaceURI:a0,tagName:"template"});let c=U(a.tagName),d=U(b.tagName);return!!a2[a.namespaceURI]&&(a.namespaceURI===a$?b.namespaceURI===a_?"svg"===c:b.namespaceURI===aZ?"svg"===c&&("annotation-xml"===d||a4[d]):!!be[c]:a.namespaceURI===aZ?b.namespaceURI===a_?"math"===c:b.namespaceURI===a$?"math"===c&&a5[d]:!!bf[c]:a.namespaceURI===a_?(b.namespaceURI!==a$||!!a5[d])&&(b.namespaceURI!==aZ||!!a4[d])&&!bf[c]&&(a6[c]||!be[c]):"application/xhtml+xml"===a7&&!!a2[a.namespaceURI])},bh=function(a){S(d.removed,{element:a});try{v(a).removeChild(a)}catch(b){s(a)}},bi=function(a,b){try{S(d.removed,{attribute:b.getAttributeNode(a),from:b})}catch(a){S(d.removed,{attribute:null,from:b})}if(b.removeAttribute(a),"is"===a)if(aL||aM)try{bh(b)}catch(a){}else try{b.setAttribute(a,"")}catch(a){}},bj=function(a){let c=null,d=null;if(aK)a="<remove></remove>"+a;else{let b=W(a,/^[\r\n\t ]+/);d=b&&b[0]}"application/xhtml+xml"===a7&&a0===a_&&(a='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+a+"</body></html>");let f=b?b.createHTML(a):a;if(a0===a_)try{c=new o().parseFromString(f,a7)}catch(a){}if(!c||!c.documentElement){c=x.createDocument(a0,"template",null);try{c.documentElement.innerHTML=a1?w:f}catch(a){}}let g=c.body||c.documentElement;return(a&&d&&g.insertBefore(e.createTextNode(d),g.childNodes[0]||null),a0===a_)?A.call(c,aI?"html":"body")[0]:aI?c.documentElement:g},bk=function(a){return y.call(a.ownerDocument||a,a,l.SHOW_ELEMENT|l.SHOW_COMMENT|l.SHOW_TEXT|l.SHOW_PROCESSING_INSTRUCTION|l.SHOW_CDATA_SECTION,null)},bl=function(a){return a instanceof n&&("string"!=typeof a.nodeName||"string"!=typeof a.textContent||"function"!=typeof a.removeChild||!(a.attributes instanceof m)||"function"!=typeof a.removeAttribute||"function"!=typeof a.setAttribute||"string"!=typeof a.namespaceURI||"function"!=typeof a.insertBefore||"function"!=typeof a.hasChildNodes)},bm=function(a){return"function"==typeof j&&a instanceof j};function bn(a,b,c){P(a,a=>{a.call(d,b,c,ba)})}let bo=function(a){let b=null;if(bn(C.beforeSanitizeElements,a,null),bl(a))return bh(a),!0;let c=a9(a.nodeName);if(bn(C.uponSanitizeElement,a,{tagName:c,allowedTags:ab}),aH&&a.hasChildNodes()&&!bm(a.firstElementChild)&&_(/<[/\w!]/g,a.innerHTML)&&_(/<[/\w!]/g,a.textContent)||7===a.nodeType||aH&&8===a.nodeType&&_(/<[/\w]/g,a.data))return bh(a),!0;if(!(ax.tagCheck instanceof Function&&ax.tagCheck(c))&&(!ab[c]||au[c])){if(!au[c]&&bq(c)&&(at.tagNameCheck instanceof RegExp&&_(at.tagNameCheck,c)||at.tagNameCheck instanceof Function&&at.tagNameCheck(c)))return!1;if(aQ&&!aT[c]){let b=v(a)||a.parentNode,c=u(a)||a.childNodes;if(c&&b){let d=c.length;for(let e=d-1;e>=0;--e){let d=r(c[e],!0);d.__removalCount=(a.__removalCount||0)+1,b.insertBefore(d,t(a))}}}return bh(a),!0}return a instanceof k&&!bg(a)||("noscript"===c||"noembed"===c||"noframes"===c)&&_(/<\/no(script|embed|frames)/i,a.innerHTML)?(bh(a),!0):(aG&&3===a.nodeType&&(b=a.textContent,P([D,E,G],a=>{b=X(b,a," ")}),a.textContent!==b&&(S(d.removed,{element:a.cloneNode()}),a.textContent=b)),bn(C.afterSanitizeElements,a,null),!1)},bp=function(a,b,c){if(aO&&("id"===b||"name"===b)&&(c in e||c in bb))return!1;if(aD&&!aw[b]&&_(H,b));else if(aC&&_(I,b));else if(ax.attributeCheck instanceof Function&&ax.attributeCheck(b,a));else if(!ar[b]||aw[b]){if(!(bq(a)&&(at.tagNameCheck instanceof RegExp&&_(at.tagNameCheck,a)||at.tagNameCheck instanceof Function&&at.tagNameCheck(a))&&(at.attributeNameCheck instanceof RegExp&&_(at.attributeNameCheck,b)||at.attributeNameCheck instanceof Function&&at.attributeNameCheck(b,a))||"is"===b&&at.allowCustomizedBuiltInElements&&(at.tagNameCheck instanceof RegExp&&_(at.tagNameCheck,c)||at.tagNameCheck instanceof Function&&at.tagNameCheck(c))))return!1}else if(aX[b]);else if(_(O,X(c,L,"")));else if(("src"===b||"xlink:href"===b||"href"===b)&&"script"!==a&&0===Y(c,"data:")&&aV[a]);else if(aE&&!_(J,X(c,L,"")));else if(c)return!1;return!0},bq=function(a){return"annotation-xml"!==a&&W(a,N)},br=function(a){bn(C.beforeSanitizeAttributes,a,null);let{attributes:c}=a;if(!c||bl(a))return;let e={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ar,forceKeepAttr:void 0},f=c.length;for(;f--;){let{name:g,namespaceURI:h,value:i}=c[f],j=a9(g),k="value"===g?i:Z(i);if(e.attrName=j,e.attrValue=k,e.keepAttr=!0,e.forceKeepAttr=void 0,bn(C.uponSanitizeAttribute,a,e),k=e.attrValue,aP&&("id"===j||"name"===j)&&(bi(g,a),k="user-content-"+k),aH&&_(/((--!?|])>)|<\/(style|title|textarea)/i,k)||"attributename"===j&&W(k,"href")){bi(g,a);continue}if(e.forceKeepAttr)continue;if(!e.keepAttr||!aF&&_(/\/>/i,k)){bi(g,a);continue}aG&&P([D,E,G],a=>{k=X(k,a," ")});let l=a9(a.nodeName);if(!bp(l,j,k)){bi(g,a);continue}if(b&&"object"==typeof p&&"function"==typeof p.getAttributeType)if(h);else switch(p.getAttributeType(l,j)){case"TrustedHTML":k=b.createHTML(k);break;case"TrustedScriptURL":k=b.createScriptURL(k)}if(k!==i)try{h?a.setAttributeNS(h,g,k):a.setAttribute(g,k),bl(a)?bh(a):R(d.removed)}catch(b){bi(g,a)}}bn(C.afterSanitizeAttributes,a,null)},bs=function a(b){let c=null,d=bk(b);for(bn(C.beforeSanitizeShadowDOM,b,null);c=d.nextNode();)bn(C.uponSanitizeShadowNode,c,null),bo(c),br(c),c.content instanceof h&&a(c.content);bn(C.afterSanitizeShadowDOM,b,null)};return d.sanitize=function(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=null,g=null,i=null,k=null;if((a1=!a)&&(a="<!-->"),"string"!=typeof a&&!bm(a))if("function"==typeof a.toString){if("string"!=typeof(a=a.toString()))throw aa("dirty is not a string, aborting")}else throw aa("toString is not a function");if(!d.isSupported)return a;if(aJ||bd(c),d.removed=[],"string"==typeof a&&(aR=!1),aR){if(a.nodeName){let b=a9(a.nodeName);if(!ab[b]||au[b])throw aa("root node is forbidden and cannot be sanitized in-place")}}else if(a instanceof j)1===(g=(e=bj("<!---->")).ownerDocument.importNode(a,!0)).nodeType&&"BODY"===g.nodeName||"HTML"===g.nodeName?e=g:e.appendChild(g);else{if(!aL&&!aG&&!aI&&-1===a.indexOf("<"))return b&&aN?b.createHTML(a):a;if(!(e=bj(a)))return aL?null:aN?w:""}e&&aK&&bh(e.firstChild);let l=bk(aR?a:e);for(;i=l.nextNode();)bo(i),br(i),i.content instanceof h&&bs(i.content);if(aR)return a;if(aL){if(aM)for(k=z.call(e.ownerDocument);e.firstChild;)k.appendChild(e.firstChild);else k=e;return(ar.shadowroot||ar.shadowrootmode)&&(k=B.call(f,k,!0)),k}let m=aI?e.outerHTML:e.innerHTML;return aI&&ab["!doctype"]&&e.ownerDocument&&e.ownerDocument.doctype&&e.ownerDocument.doctype.name&&_(ay,e.ownerDocument.doctype.name)&&(m="<!DOCTYPE "+e.ownerDocument.doctype.name+">\n"+m),aG&&P([D,E,G],a=>{m=X(m,a," ")}),b&&aN?b.createHTML(m):m},d.setConfig=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};bd(a),aJ=!0},d.clearConfig=function(){ba=null,aJ=!1},d.isValidAttribute=function(a,b,c){return ba||bd({}),bp(a9(a),a9(b),c)},d.addHook=function(a,b){"function"==typeof b&&S(C[a],b)},d.removeHook=function(a,b){if(void 0!==b){let c=Q(C[a],b);return -1===c?void 0:T(C[a],c,1)[0]}return R(C[a])},d.removeHooks=function(a){C[a]=[]},d.removeAllHooks=function(){C=aB()},d}(),aD=a.i(145432),aE=a.i(757215),aF=a.i(197463),aG=a.i(283954),aH=a.i(994845),aI=a.i(547885),aJ=a.i(692759),aK=a.i(183952),aL=a.i(284505),aM=a.i(448645),aN=a.i(294632),aO=a.i(700760);function aP({isOpen:a,onOpenChange:b,clientId:d,threadId:h,onComplete:j,mode:k="reply"}){let l=(0,g.useToast)(),[m,n]=(0,i.useState)(""),[o,p]=(0,i.useState)(""),[q,r]=(0,i.useState)(!1),[s,t]=(0,i.useState)(null),u=(0,i.useRef)(null),v=(0,e.useQuery)(f.api.emailMessages.getEmailThread,h?{threadId:h}:"skip"),w=(0,e.useQuery)(f.api.clients.get,{id:d}),x=(0,e.useQuery)(f.api.clientContacts.listByClient,{clientId:d}),y=(0,e.useQuery)(f.api.clientContacts.getPrimaryContact,{clientId:d}),z=(0,e.useQuery)(f.api.users.current,{}),A=(0,e.useQuery)(f.api.organizations.get,{}),B=(0,e.useMutation)(f.api.resend.replyToEmail),C=(0,e.useMutation)(f.api.resend.sendClientEmail),D=s?x?.find(a=>a._id===s):y;(0,i.useEffect)(()=>{y&&!s&&t(y._id)},[y,s]),(0,i.useEffect)(()=>{v&&v.length>0&&u.current?.scrollIntoView({behavior:"smooth"})},[v]),(0,i.useEffect)(()=>{a||(n(""),p(""),t(null))},[a]);let E=async()=>{if(!o.trim())return void l.error("Empty Message","Please enter a message to send");let a="new"===k||!v||0===v.length;if(a&&!m.trim())return void l.error("Subject Required","Please enter a subject for the email");if(!D?.email)return void l.error("No Email","The selected contact doesn't have an email address");r(!0);try{if(a)await C({clientId:d,subject:m.trim(),messageBody:o.trim()}),l.success("Email Sent","Your email has been sent successfully");else{let a=v[v.length-1];await B({emailMessageId:a._id,messageBody:o.trim()}),l.success("Reply Sent","Your reply has been sent successfully")}n(""),p(""),t(null),j?.()}catch(a){console.error("Error sending email:",a),l.error("Send Failed",a instanceof Error?a.message:"Failed to send email")}finally{r(!1)}},F="new"===k||!v||0===v.length;return(0,c.jsx)(aD.Sheet,{open:a,onOpenChange:b,children:(0,c.jsx)(aD.SheetContent,{side:"right",className:"w-full sm:max-w-3xl bg-background",children:(0,c.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,c.jsxs)(aD.SheetHeader,{className:"border-b border-border pb-4 shrink-0",children:[(0,c.jsx)(aD.SheetTitle,{className:"text-2xl font-semibold",children:v&&v.length>0?v[0].subject:"New Email"}),(0,c.jsxs)(aD.SheetDescription,{className:"text-muted-foreground",children:[w?`Conversation with ${w.companyName}`:"Loading...",D&&(0,c.jsxs)("span",{className:"block text-xs mt-1",children:["To: ",D.email]})]})]}),v&&v.length>0&&(0,c.jsx)("div",{className:"flex-1 overflow-y-auto py-6 px-6",children:(0,c.jsxs)("div",{className:"space-y-6",children:[v.map(a=>(0,c.jsx)(aQ,{message:a},a._id)),(0,c.jsx)("div",{ref:u})]})}),(!v||0===v.length)&&(0,c.jsx)("div",{className:"flex-1 flex items-center justify-center text-muted-foreground py-6",children:(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)(aJ.Send,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,c.jsx)("p",{className:"text-sm",children:"Start a new conversation"})]})}),(0,c.jsx)("div",{className:"border-t border-border shrink-0 bg-background",children:(0,c.jsxs)("div",{className:"p-6 space-y-4",children:[F&&x&&x.length>0&&(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsx)("label",{htmlFor:"contact-select",className:"text-sm font-medium text-foreground",children:"Send To"}),(0,c.jsxs)(aH.StyledSelect,{value:s||"",onValueChange:a=>t(a),children:[(0,c.jsx)(aH.StyledSelectTrigger,{id:"contact-select",children:(0,c.jsx)(aI.SelectValue,{placeholder:"Select a contact"})}),(0,c.jsx)(aH.StyledSelectContent,{children:x.map(a=>(0,c.jsx)(aI.SelectItem,{value:a._id,children:(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsxs)("span",{className:"font-medium",children:[a.firstName," ",a.lastName]}),a.isPrimary&&(0,c.jsx)("span",{className:"text-xs text-primary",children:"(Primary)"}),(0,c.jsx)("span",{className:"text-xs text-muted-foreground",children:a.email})]})},a._id))})]})]}),F&&(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsx)("label",{htmlFor:"email-subject",className:"text-sm font-medium text-foreground",children:"Subject"}),(0,c.jsx)(aG.StyledInput,{id:"email-subject",value:m,onChange:a=>n(a.target.value),placeholder:"Enter email subject...",disabled:q})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsx)("label",{htmlFor:"reply-body",className:"text-sm font-medium text-foreground",children:F?"Message":"Reply to this thread"}),(0,c.jsx)(aF.Textarea,{id:"reply-body",value:o,onChange:a=>p(a.target.value),placeholder:"Type your message here...",className:"min-h-[120px] resize-none",disabled:q}),(0,c.jsx)("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:(0,c.jsxs)("span",{children:[o.length," characters"]})}),o.trim()&&(0,c.jsxs)("div",{className:"mt-4 p-4 rounded-lg bg-muted/50 border border-border",children:[(0,c.jsx)("div",{className:"flex items-start gap-2 mb-2",children:(0,c.jsx)("div",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Email Preview"})}),(0,c.jsx)("div",{className:"text-sm text-foreground/80 whitespace-pre-wrap font-mono",children:(()=>{if(!o.trim())return"";let a=D&&`${D.firstName||""} ${D.lastName||""}`.trim()||"Client Name",b=z?.name||"Your Name",c=A?.name||"Organization";return`Hi ${a},

${o}

Best regards,
${b}
${c}`})()}),(0,c.jsx)("div",{className:"mt-2 text-xs text-muted-foreground italic",children:"This shows what your recipient will see (greeting and signature are auto-added)"})]})]}),(0,c.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,c.jsx)(aE.StyledButton,{type:"button",intent:"outline",onClick:()=>{n(""),p(""),t(null),b(!1)},label:"Close",showArrow:!1,disabled:q}),(0,c.jsx)(aE.StyledButton,{type:"button",intent:"primary",onClick:E,isLoading:q,disabled:!o.trim()||F&&!m.trim()||q,label:q?"Sending...":F?"Send Email":"Send Reply",icon:!q&&(0,c.jsx)(aJ.Send,{className:"w-4 h-4"}),showArrow:!1})]})]})})]})})})}function aQ({message:a}){var b;let d="inbound"===a.direction,g=(0,e.useQuery)(f.api.emailAttachments.listByEmail,a.hasAttachments?{emailMessageId:a._id}:"skip");return(0,c.jsxs)("div",{className:(0,aO.cn)("flex gap-3",d?"flex-row":"flex-row-reverse"),children:[(0,c.jsxs)(aM.Avatar,{className:"w-10 h-10 shrink-0",children:[(0,c.jsx)(aM.AvatarImage,{src:a.senderAvatar||void 0}),(0,c.jsx)(aM.AvatarFallback,{className:(0,aO.cn)(d?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"),children:a.senderName?.[0]||a.fromName[0]})]}),(0,c.jsxs)("div",{className:(0,aO.cn)("flex-1 max-w-[85%] space-y-1"),children:[(0,c.jsxs)("div",{className:(0,aO.cn)("flex items-baseline gap-2",d?"flex-row":"flex-row-reverse"),children:[(0,c.jsx)("span",{className:"text-sm font-medium",children:a.senderName||a.fromName}),(0,c.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,aN.formatDistanceToNow)(new Date(a.sentAt),{addSuffix:!0})})]}),(0,c.jsxs)("div",{className:(0,aO.cn)("rounded-lg px-4 py-3 text-sm",d?"bg-muted text-foreground":"bg-primary/10 text-primary ring-1 ring-primary/20 backdrop-blur-sm shadow-sm"),children:[a.htmlBody?(0,c.jsx)("div",{className:"prose prose-sm max-w-none dark:prose-invert [&>*:last-child]:mb-0",dangerouslySetInnerHTML:{__html:(b=aS(a.htmlBody,!0),aC.sanitize(b,{ALLOWED_TAGS:["p","br","b","i","u","strong","em","a","ul","ol","li","span","div"],ALLOWED_ATTR:["href","target","rel","class"]}))}}):(0,c.jsx)("div",{className:"whitespace-pre-wrap [&>*:last-child]:mb-0",children:aS(a.messageBody,!1)}),a.hasAttachments&&g&&g.length>0&&(0,c.jsx)("div",{className:"mt-3 pt-3 border-t border-border/50 space-y-2",children:g.map(a=>(0,c.jsx)(aR,{attachment:a},a._id))})]}),!d&&(0,c.jsxs)("div",{className:"text-xs text-muted-foreground text-right",children:["delivered"===a.status&&"✓ Delivered","opened"===a.status&&"✓✓ Opened","sent"===a.status&&"✓ Sent","bounced"===a.status&&"⚠ Bounced"]})]})]})}function aR({attachment:a}){let b=(0,e.useQuery)(f.api.emailAttachments.getDownloadUrl,{attachmentId:a._id});return(0,c.jsxs)("a",{href:b||"#",download:a.filename,className:(0,aO.cn)("flex items-center gap-2 p-2 rounded bg-background/50 hover:bg-background/80 transition-colors",!b&&"opacity-50 cursor-not-allowed"),onClick:a=>{b||a.preventDefault()},children:[(0,c.jsx)(aK.Paperclip,{className:"w-4 h-4"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("p",{className:"text-sm font-medium truncate",children:a.filename}),(0,c.jsx)("p",{className:"text-xs text-muted-foreground",children:function(a){if(0===a)return"0 Bytes";let b=Math.floor(Math.log(a)/Math.log(1024));return Math.round(a/Math.pow(1024,b)*100)/100+" "+["Bytes","KB","MB","GB"][b]}(a.size)})]}),(0,c.jsx)(aL.Download,{className:"w-4 h-4 shrink-0"})]})}function aS(a,b=!1){if(b){let b=a;return(b=(b=(b=(b=b.replace(/<div class="gmail_quote[^>]*">[\s\S]*?<\/div>/gi,"")).replace(/<blockquote[^>]*class="gmail_quote"[^>]*>[\s\S]*?<\/blockquote>/gi,"")).replace(/<div[^>]*class="gmail_attr"[^>]*>[\s\S]*?<\/div>/gi,"")).replace(/<div[^>]*class="gmail_signature"[^>]*>[\s\S]*?<\/div>/gi,"")).trim()}{let b=a.split("\n"),c=[],d=!1;for(let a of b){if(a.trim().startsWith(">")||a.match(/^On .+? wrote:$/i)||a.match(/^-{3,}/)){d=!0;break}if("--"===a.trim()||a.match(/^[-_]{2,}$/))break;d||c.push(a)}return c.join("\n").trim()}}var aT=a.i(28310),aU=a.i(352110),aV=a.i(165004),aW=a.i(992258);let aX=(0,a.i(170106).default)("mail-open",[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]]);var aY=a.i(563588),aZ=a.i(596221);function a$({clientId:a,children:b}){let[d,g]=(0,i.useState)(!1),[h,j]=(0,i.useState)(!1),[k,l]=(0,i.useState)(),m=(0,e.useQuery)(f.api.emailMessages.listThreadsByClient,{clientId:a});return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(aV.Popover,{open:d,onOpenChange:g,children:[(0,c.jsx)(aV.PopoverTrigger,{asChild:!0,children:b}),(0,c.jsx)(aV.PopoverContent,{className:"w-96 p-0 bg-background! backdrop-blur-xl border-border shadow-xl",align:"end",children:(0,c.jsxs)("div",{className:"flex flex-col max-h-[500px]",children:[(0,c.jsx)("div",{className:"px-4 py-3 border-b border-border bg-background",children:(0,c.jsx)("h3",{className:"font-semibold text-sm",children:"Email Threads"})}),(0,c.jsx)("div",{className:"overflow-y-auto bg-background",children:void 0===m?(0,c.jsxs)("div",{className:"px-4 py-8 flex flex-col items-center justify-center gap-3","aria-busy":"true","aria-live":"polite",children:[(0,c.jsx)(aZ.Loader2,{className:"w-8 h-8 animate-spin text-muted-foreground"}),(0,c.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading email threads..."}),(0,c.jsx)("span",{className:"sr-only",children:"Loading email threads, please wait"})]}):0===m.length?(0,c.jsxs)("div",{className:"px-4 py-8 text-center text-sm text-muted-foreground",children:[(0,c.jsx)(aY.MessageSquare,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,c.jsx)("p",{children:"No email threads yet"}),(0,c.jsx)("p",{className:"text-xs mt-1",children:"Send an email to start a conversation"})]}):(0,c.jsx)("div",{className:"divide-y divide-border",children:m.map(a=>(0,c.jsx)("button",{onClick:()=>{l(a.threadId),g(!1),j(!0)},className:"w-full px-4 py-3 text-left hover:bg-accent transition-colors",children:(0,c.jsxs)("div",{className:"flex items-start gap-3",children:[(0,c.jsx)("div",{className:(0,aO.cn)("mt-0.5",a.hasUnread?"text-primary":"text-muted-foreground"),children:a.hasUnread?(0,c.jsx)(aW.Mail,{className:"w-4 h-4"}):(0,c.jsx)(aX,{className:"w-4 h-4"})}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("div",{className:"flex items-baseline justify-between gap-2 mb-1",children:[(0,c.jsx)("h4",{className:(0,aO.cn)("text-sm truncate",a.hasUnread?"font-semibold":"font-medium"),children:a.subject}),(0,c.jsx)("span",{className:"text-xs text-muted-foreground shrink-0",children:(0,aN.formatDistanceToNow)(new Date(a.latestMessageAt),{addSuffix:!0})})]}),(0,c.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-2",children:a.latestMessage}),(0,c.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,c.jsxs)("span",{className:"text-xs text-muted-foreground",children:[a.messageCount," ",1===a.messageCount?"message":"messages"]}),a.hasUnread&&(0,c.jsx)("span",{className:"text-xs font-medium text-primary",children:"• New"})]})]})]})},a.threadId))})})]})})]}),(0,c.jsx)(aP,{isOpen:h,onOpenChange:j,clientId:a,threadId:k,mode:k?"reply":"new",onComplete:()=>{j(!1)}})]})}var a_=a.i(915618),a0=a.i(296101),a1=a.i(501199),a2=a.i(104720),a3=a.i(911300),a4=a.i(968177);let a5=["lead","prospect","active","inactive","archived"];function a6(a){return a.charAt(0).toUpperCase()+a.slice(1)}function a7(a){return a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Not set"}function a8(a){switch(a){case"lead":case"prospect":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400";case"active":case"paid":case"approved":case"completed":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";case"sent":case"pending":case"in-progress":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400";case"inactive":case"cancelled":case"overdue":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400"}}function a9({client:a,clientId:b,isEditing:e,onEditClick:f,statusValue:h,onStatusChange:i,emailCount:j,projects:k,quotes:l,invoices:m,tasks:n,onTaskSheetOpen:o}){let q=(0,d.useRouter)(),r=(0,g.useToast)();return(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsx)("div",{className:"flex items-start justify-between gap-6 mb-6",children:(0,c.jsxs)("div",{className:"flex items-start gap-6",children:[(0,c.jsx)("div",{className:"flex items-center justify-center w-16 h-16 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 dark:from-blue-600 dark:to-blue-700 shrink-0 shadow-md",children:(0,c.jsx)(s,{className:"h-8 w-8 text-white"})}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[(0,c.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:a.companyName}),e?(0,c.jsxs)(aU.StyledSelect,{value:h,onValueChange:i,children:[(0,c.jsx)(aU.StyledSelectTrigger,{className:"w-auto",children:(0,c.jsx)(aU.SelectValue,{})}),(0,c.jsx)(aU.StyledSelectContent,{children:a5.map(a=>(0,c.jsx)(aU.SelectItem,{value:a,children:a6(a)},a))})]}):(0,c.jsx)(aT.ProminentStatusBadge,{status:a.status,size:"large",showIcon:!0,entityType:"client"})]}),!e&&(0,c.jsxs)("button",{onClick:f,className:"inline-flex items-center gap-2 text-sm text-primary hover:text-primary/80 font-medium transition-colors",children:[(0,c.jsx)(u.PencilIcon,{className:"h-4 w-4"}),"Edit Details"]})]})]})}),(0,c.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[(0,c.jsx)(a$,{clientId:b,children:(0,c.jsxs)("button",{className:"flex flex-col items-center justify-center p-4 rounded-lg border border-gray-300 dark:border-white/20 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-all",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,c.jsx)("svg",{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),(0,c.jsx)("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:j})]}),(0,c.jsx)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Messages"})]})}),(0,c.jsxs)(aV.Popover,{children:[(0,c.jsx)(aV.PopoverTrigger,{asChild:!0,children:(0,c.jsxs)("button",{className:"flex flex-col items-center justify-center p-4 rounded-lg border border-gray-300 dark:border-white/20 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-all",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,c.jsx)("svg",{className:"w-5 h-5 text-purple-600 dark:text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),(0,c.jsx)("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:k?.length||0})]}),(0,c.jsx)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Projects"})]})}),(0,c.jsxs)(aV.PopoverContent,{className:"w-96 p-0 bg-white dark:bg-gray-900",align:"start",side:"bottom",children:[(0,c.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-white/10",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Projects"}),(0,c.jsxs)(p.Button,{intent:"outline",size:"sm",onPress:()=>q.push(`/projects/new?clientId=${b}`),children:[(0,c.jsx)(a_.Plus,{className:"h-4 w-4 mr-2"}),"New"]})]})}),(0,c.jsx)("div",{className:"max-h-96 overflow-y-auto",children:k&&k.length>0?(0,c.jsx)("div",{className:"p-2",children:k.map(a=>(0,c.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-white/5 rounded-lg transition-colors cursor-pointer",onClick:()=>q.push(`/projects/${a._id}`),children:[(0,c.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,c.jsx)("div",{className:`w-2 h-2 rounded-full shrink-0 ${"completed"===a.status?"bg-green-500":"in-progress"===a.status?"bg-yellow-500":"bg-blue-500"}`}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("p",{className:"font-medium text-sm text-gray-900 dark:text-white truncate",children:a.title}),a.description&&(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:a.description})]})]}),(0,c.jsx)(a4.Badge,{className:a8(a.status),variant:"outline",children:a6(a.status)})]},a._id))}):(0,c.jsxs)("div",{className:"p-8 text-center",children:[(0,c.jsx)(a0.FolderOpen,{className:"h-12 w-12 text-gray-400 dark:text-gray-600 mx-auto mb-3"}),(0,c.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No projects yet"})]})})]})]}),(0,c.jsxs)(aV.Popover,{children:[(0,c.jsx)(aV.PopoverTrigger,{asChild:!0,children:(0,c.jsxs)("button",{className:"flex flex-col items-center justify-center p-4 rounded-lg border border-gray-300 dark:border-white/20 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-all",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,c.jsx)("svg",{className:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2z"})}),(0,c.jsx)("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l?.length||0})]}),(0,c.jsx)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Quotes"})]})}),(0,c.jsxs)(aV.PopoverContent,{className:"w-96 p-0 bg-white dark:bg-gray-900",align:"start",side:"bottom",children:[(0,c.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-white/10",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Quotes"}),(0,c.jsxs)(p.Button,{intent:"outline",size:"sm",onPress:()=>q.push(`/quotes/new?clientId=${b}`),children:[(0,c.jsx)(a_.Plus,{className:"h-4 w-4 mr-2"}),"New"]})]})}),(0,c.jsx)("div",{className:"max-h-96 overflow-y-auto",children:l&&l.length>0?(0,c.jsx)("div",{className:"p-2",children:l.map(a=>(0,c.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-white/5 rounded-lg transition-colors cursor-pointer",onClick:()=>q.push(`/quotes/${a._id}`),children:[(0,c.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,c.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500 shrink-0"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("p",{className:"font-medium text-sm text-gray-900 dark:text-white truncate",children:["Quote #",a.quoteNumber]}),a.title&&(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:a.title})]})]}),(0,c.jsxs)("div",{className:"text-right shrink-0",children:[a.total&&(0,c.jsxs)("p",{className:"font-medium text-sm text-gray-900 dark:text-white",children:["$",a.total.toLocaleString()]}),(0,c.jsx)(a4.Badge,{className:a8(a.status||"draft"),variant:"outline",children:a.status||"draft"})]})]},a._id))}):(0,c.jsxs)("div",{className:"p-8 text-center",children:[(0,c.jsx)(a1.Receipt,{className:"h-12 w-12 text-gray-400 dark:text-gray-600 mx-auto mb-3"}),(0,c.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No quotes yet"})]})})]})]}),(0,c.jsxs)(aV.Popover,{children:[(0,c.jsx)(aV.PopoverTrigger,{asChild:!0,children:(0,c.jsxs)("button",{className:"flex flex-col items-center justify-center p-4 rounded-lg border border-gray-300 dark:border-white/20 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-all",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,c.jsx)("svg",{className:"w-5 h-5 text-orange-600 dark:text-orange-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,c.jsx)("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:m?.length||0})]}),(0,c.jsx)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Invoices"})]})}),(0,c.jsxs)(aV.PopoverContent,{className:"w-96 p-0 bg-white dark:bg-gray-900",align:"start",side:"bottom",children:[(0,c.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-white/10",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Invoices"}),(0,c.jsxs)(p.Button,{intent:"outline",size:"sm",onPress:()=>r.info("Create Invoice","Invoice creation functionality coming soon!"),children:[(0,c.jsx)(a_.Plus,{className:"h-4 w-4 mr-2"}),"New"]})]})}),(0,c.jsx)("div",{className:"max-h-96 overflow-y-auto",children:m&&m.length>0?(0,c.jsx)("div",{className:"p-2",children:m.map(a=>(0,c.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-white/5 rounded-lg transition-colors cursor-pointer",onClick:()=>r.info("View Invoice","Invoice detail page coming soon!"),children:[(0,c.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,c.jsx)("div",{className:`w-2 h-2 rounded-full shrink-0 ${"paid"===a.status?"bg-green-500":"sent"===a.status?"bg-yellow-500":"bg-red-500"}`}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("p",{className:"font-medium text-sm text-gray-900 dark:text-white truncate",children:["Invoice #",a.invoiceNumber]}),(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a7(a._creationTime)})]})]}),(0,c.jsxs)("div",{className:"text-right shrink-0",children:[a.total&&(0,c.jsxs)("p",{className:"font-medium text-sm text-gray-900 dark:text-white",children:["$",a.total.toLocaleString()]}),(0,c.jsx)(a4.Badge,{className:a8(a.status),variant:"outline",children:a.status})]})]},a._id))}):(0,c.jsxs)("div",{className:"p-8 text-center",children:[(0,c.jsx)(a2.FileText,{className:"h-12 w-12 text-gray-400 dark:text-gray-600 mx-auto mb-3"}),(0,c.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No invoices yet"})]})})]})]}),(0,c.jsxs)(aV.Popover,{children:[(0,c.jsx)(aV.PopoverTrigger,{asChild:!0,children:(0,c.jsxs)("button",{className:"flex flex-col items-center justify-center p-4 rounded-lg border border-gray-300 dark:border-white/20 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-all",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,c.jsx)("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),(0,c.jsx)("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n?.length||0})]}),(0,c.jsx)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Tasks"})]})}),(0,c.jsxs)(aV.PopoverContent,{className:"w-96 p-0 bg-white dark:bg-gray-900",align:"end",side:"bottom",children:[(0,c.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-white/10",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Tasks"}),(0,c.jsxs)(p.Button,{intent:"outline",size:"sm",onPress:o,children:[(0,c.jsx)(a_.Plus,{className:"h-4 w-4 mr-2"}),"New"]})]})}),(0,c.jsx)("div",{className:"max-h-96 overflow-y-auto",children:n&&n.length>0?(0,c.jsx)("div",{className:"p-2",children:n.map(a=>(0,c.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-white/5 rounded-lg transition-colors",children:[(0,c.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,c.jsx)("div",{className:`w-2 h-2 rounded-full shrink-0 ${"completed"===a.status?"bg-green-500":"cancelled"===a.status?"bg-red-500":"bg-yellow-500"}`}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("p",{className:"font-medium text-sm text-gray-900 dark:text-white truncate",children:a.title}),a.date&&(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a7(a.date)})]})]}),(0,c.jsx)(a4.Badge,{className:a8(a.status),variant:"outline",children:a.status})]},a._id))}):(0,c.jsxs)("div",{className:"p-8 text-center",children:[(0,c.jsx)(a3.ClipboardList,{className:"h-12 w-12 text-gray-400 dark:text-gray-600 mx-auto mb-3"}),(0,c.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No tasks yet"})]})})]})]})]})]})}var ba=a.i(658547);function bb(a){return a?a.charAt(0).toUpperCase()+a.slice(1):"Not specified"}function bc({client:a,isEditing:b,form:d,onFormChange:e}){var f;return(0,c.jsxs)(n.StyledCard,{children:[(0,c.jsx)(n.StyledCardHeader,{children:(0,c.jsx)(n.StyledCardTitle,{className:"text-xl",children:"About"})}),(0,c.jsx)(n.StyledCardContent,{children:(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6",children:[(a.industry||b)&&(0,c.jsxs)("div",{children:[(0,c.jsx)(ba.Label,{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2 block",children:"Industry"}),b?(0,c.jsx)(aG.StyledInput,{value:d.industry,onChange:a=>e("industry",a.target.value),placeholder:"e.g., Technology, Healthcare"}):(0,c.jsx)("p",{className:"text-sm text-gray-900 dark:text-white",children:a.industry})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)(ba.Label,{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2 block",children:"Lead Source"}),(0,c.jsx)("p",{className:"text-sm text-gray-900 dark:text-white",children:(f=a.leadSource)?f.split("-").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "):"Not specified"})]}),(a.category||b)&&(0,c.jsxs)("div",{children:[(0,c.jsx)(ba.Label,{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2 block",children:"Category"}),b?(0,c.jsx)(aG.StyledInput,{value:d.category,onChange:a=>e("category",a.target.value),placeholder:"e.g., Enterprise, SMB"}):(0,c.jsx)("p",{className:"text-sm text-gray-900 dark:text-white",children:bb(a.category)})]}),(a.clientSize||b)&&(0,c.jsxs)("div",{children:[(0,c.jsx)(ba.Label,{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2 block",children:"Size"}),b?(0,c.jsx)(aG.StyledInput,{value:d.clientSize,onChange:a=>e("clientSize",a.target.value),placeholder:"e.g., 1-10, 50-200"}):(0,c.jsx)("p",{className:"text-sm text-gray-900 dark:text-white",children:bb(a.clientSize)})]}),(a.priorityLevel||b)&&(0,c.jsxs)("div",{children:[(0,c.jsx)(ba.Label,{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2 block",children:"Priority"}),b?(0,c.jsx)(aG.StyledInput,{value:d.priorityLevel,onChange:a=>e("priorityLevel",a.target.value),placeholder:"e.g., High, Medium, Low"}):(0,c.jsx)("p",{className:"text-sm text-gray-900 dark:text-white",children:bb(a.priorityLevel)})]}),(a.projectDimensions||b)&&(0,c.jsxs)("div",{children:[(0,c.jsx)(ba.Label,{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2 block",children:"Project Dimensions"}),b?(0,c.jsx)(aG.StyledInput,{value:d.projectDimensions,onChange:a=>e("projectDimensions",a.target.value),placeholder:"Enter dimensions"}):(0,c.jsx)("p",{className:"text-sm text-gray-900 dark:text-white",children:a.projectDimensions})]})]}),(a.companyDescription||b)&&(0,c.jsxs)("div",{className:"pt-4 border-t border-gray-200 dark:border-white/10",children:[(0,c.jsx)(ba.Label,{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2 block",children:"Company Description"}),b?(0,c.jsx)(aF.Textarea,{value:d.companyDescription,onChange:a=>e("companyDescription",a.target.value),placeholder:"Brief description of the company and what they do...",className:"w-full",rows:3}):(0,c.jsx)("p",{className:"text-sm text-gray-900 dark:text-white whitespace-pre-wrap",children:a.companyDescription})]})]})})]})}var bd=a.i(405784),be=a.i(598091),be=be;function bf({client:a,primaryContact:b,isEditing:d,form:e,onFormChange:f,clientEmails:h,invoices:j}){var l;let m,o;(0,g.useToast)();let[p,q]=(0,i.useState)(!1);return(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsxs)(n.StyledCard,{children:[(0,c.jsx)(n.StyledCardHeader,{children:(0,c.jsx)(n.StyledCardTitle,{className:"text-lg",children:"Contact Info"})}),(0,c.jsx)(n.StyledCardContent,{className:"space-y-4",children:b?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"space-y-3",children:[(0,c.jsxs)("div",{className:"flex items-start justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Primary contact"}),(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsxs)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[b.firstName," ",b.lastName]}),(0,c.jsx)(y,{className:"h-4 w-4 text-yellow-400"})]})]}),b.jobTitle&&(0,c.jsxs)("div",{className:"flex items-start justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Job Title"}),(0,c.jsx)("span",{className:"text-sm text-gray-900 dark:text-white text-right",children:b.jobTitle})]}),b.phone&&(0,c.jsxs)("div",{className:"flex items-start justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Phone"}),(0,c.jsx)("span",{className:"text-sm text-gray-900 dark:text-white",children:(l=b.phone)?l:""})]}),b.email&&(0,c.jsxs)("div",{className:"flex items-start justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Email"}),(0,c.jsx)("span",{className:"text-sm text-gray-900 dark:text-white text-right break-all",children:b.email})]})]}),(0,c.jsx)("div",{className:"pt-4 border-t border-gray-200 dark:border-white/10",children:(0,c.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Communication Preference"}),d?(0,c.jsx)("div",{className:"flex-1 max-w-[180px]",children:(0,c.jsxs)(aU.StyledSelect,{value:e.communicationPreference,onValueChange:a=>f("communicationPreference",a),children:[(0,c.jsx)(aU.StyledSelectTrigger,{className:"h-8",children:(0,c.jsx)(aU.SelectValue,{placeholder:"Select"})}),(0,c.jsxs)(aU.StyledSelectContent,{children:[(0,c.jsx)(aU.SelectItem,{value:"email",children:"Email only"}),(0,c.jsx)(aU.SelectItem,{value:"phone",children:"Phone calls for urgent matters"}),(0,c.jsx)(aU.SelectItem,{value:"both",children:"Both email and phone"})]})]})}):(0,c.jsx)("span",{className:"text-sm text-gray-900 dark:text-white text-right",children:function(a){if(!a)return"Not specified";switch(a){case"email":return"Email only";case"phone":return"Phone calls for urgent matters";case"both":return"Both email and phone";default:return a}}(a.communicationPreference)})]})})]}):(0,c.jsx)("div",{className:"text-center py-4",children:(0,c.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"No primary contact set"})})})]}),(0,c.jsxs)(n.StyledCard,{children:[(0,c.jsx)(n.StyledCardHeader,{children:(0,c.jsx)(n.StyledCardTitle,{className:"text-lg",children:"Last client communication"})}),(0,c.jsx)(n.StyledCardContent,{children:h&&h.length>0?(o="inbound"===(m=h[0]).direction,(0,c.jsxs)("div",{className:"space-y-3",children:[(0,c.jsx)("div",{className:"flex items-start justify-between gap-2",children:(0,c.jsxs)("div",{className:"flex items-start gap-2 flex-1 min-w-0",children:[(0,c.jsx)("div",{className:`w-2 h-2 rounded-full shrink-0 mt-1.5 ${o?"bg-blue-500":"delivered"===m.status||"opened"===m.status?"bg-green-500":"sent"===m.status?"bg-blue-500":"bg-red-500"}`}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("div",{className:"flex items-center gap-2 mb-1",children:(0,c.jsx)("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${o?"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400":"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400"}`,children:o?"Inbound":"Outbound"})}),(0,c.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:m.subject}),(0,c.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["From:"," ",(0,c.jsx)("span",{className:"font-medium",children:m.fromName})]}),(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:new Date(m.sentAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})})]})]})}),!o&&(0,c.jsxs)("div",{className:"flex items-center gap-1.5 pl-4",children:["opened"===m.status&&(0,c.jsxs)("span",{className:"text-xs text-purple-600 dark:text-purple-400 flex items-center gap-1",children:[(0,c.jsxs)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Opened"]}),"delivered"===m.status&&(0,c.jsxs)("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:[(0,c.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Delivered"]}),"sent"===m.status&&(0,c.jsxs)("span",{className:"text-xs text-blue-600 dark:text-blue-400 flex items-center gap-1",children:[(0,c.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Sent"]}),"bounced"===m.status&&(0,c.jsxs)("span",{className:"text-xs text-red-600 dark:text-red-400 flex items-center gap-1",children:[(0,c.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Bounced"]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("button",{onClick:()=>q(!p),className:"flex items-center gap-2 text-xs text-primary hover:text-primary/80 font-medium transition-colors w-full pl-4",children:p?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(be.default,{className:"w-3 h-3"}),"Hide message"]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(bd.ChevronDown,{className:"w-3 h-3"}),"Show message"]})}),p&&(0,c.jsx)("div",{className:"mt-3 pl-4",children:(0,c.jsx)("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3 text-xs text-gray-700 dark:text-gray-300 whitespace-pre-wrap border border-gray-200 dark:border-gray-700",children:m.messageBody||m.textBody||m.messagePreview||"No message content"})})]}),h.length>1&&(0,c.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic pl-4 pt-2 border-t border-gray-200 dark:border-gray-700",children:[h.length-1," earlier message",h.length-1!=1?"s":""]})]})):(0,c.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 italic",children:"You haven't sent any client communications yet"})})]}),(0,c.jsxs)(n.StyledCard,{children:[(0,c.jsx)(n.StyledCardHeader,{children:(0,c.jsx)(n.StyledCardTitle,{className:"text-lg",children:"Billing summary"})}),(0,c.jsx)(n.StyledCardContent,{className:"space-y-4",children:j&&j.length>0?(0,c.jsxs)("div",{className:"space-y-3",children:[(0,c.jsxs)("div",{className:"flex justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total invoices"}),(0,c.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:j.length})]}),(0,c.jsxs)("div",{className:"flex justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total billed"}),(0,c.jsxs)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["$",j.reduce((a,b)=>a+b.total,0).toLocaleString()]})]}),(0,c.jsxs)("div",{className:"flex justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Outstanding"}),(0,c.jsxs)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["$",j.filter(a=>"paid"!==a.status).reduce((a,b)=>a+b.total,0).toLocaleString()]})]})]}):(0,c.jsxs)("div",{className:"flex flex-col items-center text-center py-6",children:[(0,c.jsx)("div",{className:"w-12 h-12 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center mb-3",children:(0,c.jsx)(k,{className:"h-6 w-6 text-gray-400"})}),(0,c.jsx)("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"No billing history"}),(0,c.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This client hasn't been billed yet"})]})})]})]})}function bg({isEditing:a,notes:b,onNotesChange:d}){return(0,c.jsxs)(n.StyledCard,{children:[(0,c.jsxs)(n.StyledCardHeader,{children:[(0,c.jsx)(n.StyledCardTitle,{className:"text-lg",children:"Client notes"}),(0,c.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Internal notes visible only to your team"})]}),(0,c.jsx)(n.StyledCardContent,{children:a?(0,c.jsx)("textarea",{className:"w-full min-h-[100px] px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-white/10 rounded-md text-gray-900 dark:text-white",value:b,onChange:a=>d(a.target.value)}):b?(0,c.jsx)("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg",children:(0,c.jsx)("p",{className:"text-sm text-gray-900 dark:text-white whitespace-pre-wrap",children:b})}):(0,c.jsx)("div",{className:"text-center py-6",children:(0,c.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 italic",children:"No notes added for this client yet"})})})]})}var bh=a.i(670228);function bi({client:a,isEditing:b,tags:d,onTagsChange:e}){let f=(0,g.useToast)(),[h,j]=(0,i.useState)([]);return(0,i.useEffect)(()=>{j(d?d.split(/,\s*/).filter(Boolean):a.tags||[])},[d,a.tags]),(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsxs)(n.StyledCard,{children:[(0,c.jsx)(n.StyledCardHeader,{children:(0,c.jsx)(n.StyledCardTitle,{className:"text-xl",children:"Tags"})}),(0,c.jsxs)(n.StyledCardContent,{children:[(0,c.jsx)(bh.StyledTagsInput,{tags:h,setTags:a=>{let b="function"==typeof a?a(h):a;j(b),e(b.join(", "))},onTagAdded:a=>{f.success("Tag Added",`"${a}" has been added to this client.`)},onTagRemoved:a=>{f.success("Tag Removed",`"${a}" has been removed from this client.`)},placeholder:"Type a tag and press Enter or comma...",disabled:!b}),!b&&0===h.length&&(0,c.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 italic mt-3",children:"This client has no tags. Click Edit to add tags."})]})]}),a.servicesNeeded&&a.servicesNeeded.length>0&&(0,c.jsxs)(n.StyledCard,{children:[(0,c.jsx)(n.StyledCardHeader,{children:(0,c.jsx)(n.StyledCardTitle,{className:"text-xl",children:"Services needed"})}),(0,c.jsx)(n.StyledCardContent,{children:(0,c.jsx)("div",{className:"space-y-2",children:a.servicesNeeded.map((a,b)=>(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,c.jsx)("span",{className:"text-sm text-gray-900 dark:text-white",children:a})]},b))})})]})]})}var bj=a.i(388249);function bk(){let a,b=(0,d.useParams)();(0,d.useRouter)();let n=b.clientId,o=(0,g.useToast)(),p=(0,e.useMutation)(f.api.clients.update),[q,r]=(0,i.useState)(!1),[s,t]=(0,i.useState)(!1),[u,v]=(0,i.useState)(!1),[w,x]=(0,i.useState)("new"),[y,A]=(0,i.useState)("details"),[C,F]=(0,i.useState)({industry:"",companyDescription:"",status:"lead",category:"",clientSize:"",priorityLevel:"",projectDimensions:"",communicationPreference:"",tags:"",notes:""}),G=(0,e.useQuery)(f.api.clients.get,{id:n}),H=(0,e.useQuery)(f.api.clientContacts.listByClient,{clientId:n}),I=(0,e.useQuery)(f.api.clientProperties.listByClient,{clientId:n}),J=(0,e.useQuery)(f.api.clientContacts.getPrimaryContact,{clientId:n}),K=(0,e.useQuery)(f.api.quotes.list,{clientId:n}),L=(0,e.useQuery)(f.api.projects.list,{clientId:n}),M=(0,e.useQuery)(f.api.invoices.list,{clientId:n}),N=(0,e.useQuery)(f.api.tasks.list,{clientId:n}),O=(0,e.useQuery)(f.api.emailMessages.listByClient,{clientId:n});(0,i.useEffect)(()=>{G&&F({industry:G.industry||"",companyDescription:G.companyDescription||"",status:G.status,category:G.category||"",clientSize:G.clientSize||"",priorityLevel:G.priorityLevel||"",projectDimensions:G.projectDimensions||"",communicationPreference:G.communicationPreference||"",tags:(G.tags||[]).join(", "),notes:G.notes||""})},[G]);let P=(0,i.useMemo)(()=>!!G&&((C.industry||"")!==(G.industry||"")||(C.companyDescription||"")!==(G.companyDescription||"")||C.status!==G.status||(C.category||"")!==(G.category||"")||(C.clientSize||"")!==(G.clientSize||"")||(C.priorityLevel||"")!==(G.priorityLevel||"")||(C.projectDimensions||"")!==(G.projectDimensions||"")||(C.communicationPreference||"")!==(G.communicationPreference||"")||(C.tags||"")!==(G.tags||[]).join(", ")||(C.notes||"")!==(G.notes||"")),[C,G]),Q=async()=>{if(!G)return;let a={};if((C.industry||"")!==(G.industry||"")&&(a.industry=C.industry||void 0),(C.companyDescription||"")!==(G.companyDescription||"")&&(a.companyDescription=C.companyDescription||void 0),C.status!==G.status&&(a.status=C.status),(C.category||"")!==(G.category||"")&&(a.category=C.category||void 0),(C.clientSize||"")!==(G.clientSize||"")&&(a.clientSize=C.clientSize||void 0),(C.priorityLevel||"")!==(G.priorityLevel||"")&&(a.priorityLevel=C.priorityLevel||void 0),(C.projectDimensions||"")!==(G.projectDimensions||"")&&(a.projectDimensions=C.projectDimensions||void 0),(C.communicationPreference||"")!==(G.communicationPreference||"")&&(a.communicationPreference=C.communicationPreference||void 0),(C.tags||"")!==(G.tags||[]).join(", ")&&(a.tags=C.tags?C.tags.split(/,\s*/).filter(Boolean):void 0),(C.notes||"")!==(G.notes||"")&&(a.notes=C.notes||void 0),0===Object.keys(a).length)return void r(!1);try{await p({id:n,...a}),o.success("Client Updated","Your changes have been saved."),r(!1)}catch(b){let a=b instanceof Error?b.message:"Failed to save changes";o.error("Error",a)}};return void 0===G||void 0===H||void 0===I||void 0===J||void 0===K||void 0===L||void 0===M||void 0===N||void 0===O?(0,c.jsx)("div",{className:"relative px-6 pt-8 pb-20",children:(0,c.jsx)("div",{className:"mx-auto",children:(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsx)(h.Skeleton,{className:"h-12 w-64"}),(0,c.jsx)(h.Skeleton,{className:"h-32 w-full"}),(0,c.jsx)(h.Skeleton,{className:"h-64 w-full"}),(0,c.jsx)(h.Skeleton,{className:"h-64 w-full"})]})})}):G?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"relative min-h-screen p-6 pb-20",children:(0,c.jsxs)("div",{children:[(0,c.jsx)(a9,{client:G,clientId:n,isEditing:q,onEditClick:()=>r(!0),statusValue:C.status,onStatusChange:a=>F(b=>({...b,status:a})),emailCount:O?.length||0,projects:L,quotes:K,invoices:M,tasks:N,onTaskSheetOpen:()=>t(!0)}),(0,c.jsxs)(bj.StyledTabs,{value:y,onValueChange:A,children:[(0,c.jsxs)(bj.StyledTabsList,{children:[(0,c.jsx)(bj.StyledTabsTrigger,{value:"details",children:"Client Details"}),(0,c.jsx)(bj.StyledTabsTrigger,{value:"properties",children:"Properties & Contacts"}),(0,c.jsx)(bj.StyledTabsTrigger,{value:"communication",children:"Internal Team Communication"})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6",children:[(0,c.jsxs)("div",{className:"xl:col-span-3",children:[(0,c.jsxs)(bj.StyledTabsContent,{value:"details",className:"space-y-6 mt-0",children:[(0,c.jsx)(bc,{client:G,isEditing:q,form:{industry:C.industry,companyDescription:C.companyDescription,category:C.category,clientSize:C.clientSize,priorityLevel:C.priorityLevel,projectDimensions:C.projectDimensions},onFormChange:(a,b)=>F(c=>({...c,[a]:b}))}),(0,c.jsx)(bi,{client:G,isEditing:q,tags:C.tags,onTagsChange:a=>F(b=>({...b,tags:a}))}),(0,c.jsx)(bg,{isEditing:q,notes:C.notes,onNotesChange:a=>F(b=>({...b,notes:a}))})]}),(0,c.jsxs)(bj.StyledTabsContent,{value:"properties",className:"space-y-6 mt-0",children:[(0,c.jsx)(z,{clientId:n,properties:I||[],onChange:()=>{}}),(0,c.jsx)(B,{clientId:n,contacts:H||[],onChange:()=>{}})]}),(0,c.jsx)(bj.StyledTabsContent,{value:"communication",className:"mt-0",children:(0,c.jsx)(E.MentionSection,{entityType:"client",entityId:n,entityName:G.companyName})})]}),(0,c.jsx)("div",{className:"xl:col-span-1",children:(0,c.jsx)("div",{className:"sticky top-24",children:(0,c.jsx)(bf,{client:G,primaryContact:J,isEditing:q,form:{communicationPreference:C.communicationPreference},onFormChange:(a,b)=>F(c=>({...c,[a]:b})),clientEmails:O,invoices:M})})})]})]})]})}),(0,c.jsx)(aP,{isOpen:u,onOpenChange:v,clientId:n,mode:w,onComplete:()=>{v(!1)}}),(0,c.jsx)(m.StickyFormFooter,{buttons:((a=[]).push({label:"Save",onClick:Q,intent:"primary",disabled:!P,icon:(0,c.jsx)(l.Check,{className:"h-4 w-4"})}),q&&a.push({label:"Cancel",onClick:()=>{r(!1),F({industry:G?.industry||"",companyDescription:G?.companyDescription||"",status:G?.status||"lead",category:G?.category||"",clientSize:G?.clientSize||"",priorityLevel:G?.priorityLevel||"",projectDimensions:G?.projectDimensions||"",communicationPreference:G?.communicationPreference||"",tags:(G?.tags||[]).join(", "),notes:G?.notes||""})},intent:"outline"}),J?.email&&!q&&a.push({label:"Send Email",onClick:()=>{x("new"),v(!0)},intent:"secondary",icon:(0,c.jsx)(k,{className:"h-4 w-4"}),position:"right"}),a),hasUnsavedChanges:P,isEditing:q}),(0,c.jsx)(D.TaskSheet,{isOpen:s,onOpenChange:t,initialValues:{clientId:n}})]}):(0,c.jsx)("div",{className:"relative px-6 pt-8 pb-20",children:(0,c.jsx)("div",{className:"mx-auto",children:(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,c.jsx)("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center mb-4",children:(0,c.jsx)(j,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),(0,c.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Client not found"}),(0,c.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"The client you're looking for doesn't exist or you don't have permission to view it."})]})})})}a.s(["default",()=>bk],415887)}];

//# sourceMappingURL=apps_web_src_app_%28workspace%29_clients_%5BclientId%5D_page_tsx_d871f4a0._.js.map