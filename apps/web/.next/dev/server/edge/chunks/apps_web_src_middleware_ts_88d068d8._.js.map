{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/web/src/middleware.ts"],"sourcesContent":["import { clerkMiddleware, createRouteMatcher } from \"@clerk/nextjs/server\";\nimport { NextResponse } from \"next/server\";\n\nconst isPublicRoute = createRouteMatcher([\n\t\"/sign-in(.*)\",\n\t\"/sign-up(.*)\",\n\t\"/api/clerk-users-webhook(.*)\",\n\t\"/api/stripe-webhook(.*)\",\n\t\"/api/pay(.*)\",\n\t\"/pay(.*)\",\n\t\"/api/unsplash(.*)\",\n\t\"/api/schedule-demo(.*)\",\n\t\"/\",\n\t\"/privacy-policy\",\n\t\"/terms-of-service\",\n]);\n\nexport default clerkMiddleware(async (auth, request) => {\n\tconst { userId, redirectToSignIn, orgRole, sessionClaims, orgId } =\n\t\tawait auth();\n\n\t// If not logged in and not a public route, redirect to sign in\n\tif (!isPublicRoute(request) && !userId) {\n\t\treturn redirectToSignIn();\n\t}\n\n\t// Handle logged-in users\n\tif (userId) {\n\t\tconst pathname = request.nextUrl.pathname;\n\n\t\t// Check if user has an organization\n\t\tconst hasOrganization = !!orgId;\n\n\t\t// Check if user is an admin (role contains \"admin\")\n\t\tconst role = orgRole || sessionClaims?.org_role;\n\t\tconst isAdmin = role ? String(role).toLowerCase().includes(\"admin\") : false;\n\n\t\t// If user has no organization and tries to access workspace routes, redirect to org creation\n\t\tif (\n\t\t\t!hasOrganization &&\n\t\t\t!pathname.startsWith(\"/organization/\") &&\n\t\t\t!pathname.startsWith(\"/sign-\") &&\n\t\t\t!isPublicRoute(request)\n\t\t) {\n\t\t\tconst redirectUrl = request.nextUrl.clone();\n\t\t\tredirectUrl.pathname = \"/organization/complete\";\n\t\t\treturn NextResponse.redirect(redirectUrl);\n\t\t}\n\n\t\t// Redirect from root based on organization status and role\n\t\tif (pathname === \"/\") {\n\t\t\tconst redirectUrl = request.nextUrl.clone();\n\n\t\t\tif (!hasOrganization) {\n\t\t\t\t// No organization exists - send to organization creation\n\t\t\t\tredirectUrl.pathname = \"/organization/complete\";\n\t\t\t} else if (!isAdmin) {\n\t\t\t\t// Has organization but not an admin - send to projects\n\t\t\t\tredirectUrl.pathname = \"/projects\";\n\t\t\t} else {\n\t\t\t\t// Has organization and is an admin - send to home\n\t\t\t\tredirectUrl.pathname = \"/home\";\n\t\t\t}\n\n\t\t\treturn NextResponse.redirect(redirectUrl);\n\t\t}\n\n\t\t// Prevent members from accessing /home\n\t\tif (!isAdmin && pathname === \"/home\") {\n\t\t\tconst redirectUrl = request.nextUrl.clone();\n\t\t\tredirectUrl.pathname = \"/projects\";\n\t\t\treturn NextResponse.redirect(redirectUrl);\n\t\t}\n\t}\n});\n\nexport const config = {\n\tmatcher: [\n\t\t// Skip Next.js internals and all static files, unless found in search params\n\t\t\"/((?!_next|[^?]*\\\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)\",\n\t\t// Always run for API routes\n\t\t\"/(api|trpc)(.*)\",\n\t],\n};\n"],"names":[],"mappings":";;;;;;;;;;;AACA;AAAA;;;AAEA,MAAM,gBAAgB,mBAAmB;IACxC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACA;uCAEc,gBAAgB,OAAO,MAAM;IAC3C,MAAM,EAAE,MAAM,EAAE,gBAAgB,EAAE,OAAO,EAAE,aAAa,EAAE,KAAK,EAAE,GAChE,MAAM;IAEP,+DAA+D;IAC/D,IAAI,CAAC,cAAc,YAAY,CAAC,QAAQ;QACvC,OAAO;IACR;IAEA,yBAAyB;IACzB,IAAI,QAAQ;QACX,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ;QAEzC,oCAAoC;QACpC,MAAM,kBAAkB,CAAC,CAAC;QAE1B,oDAAoD;QACpD,MAAM,OAAO,WAAW,eAAe;QACvC,MAAM,UAAU,OAAO,OAAO,MAAM,WAAW,GAAG,QAAQ,CAAC,WAAW;QAEtE,6FAA6F;QAC7F,IACC,CAAC,mBACD,CAAC,SAAS,UAAU,CAAC,qBACrB,CAAC,SAAS,UAAU,CAAC,aACrB,CAAC,cAAc,UACd;YACD,MAAM,cAAc,QAAQ,OAAO,CAAC,KAAK;YACzC,YAAY,QAAQ,GAAG;YACvB,OAAO,qYAAY,CAAC,QAAQ,CAAC;QAC9B;QAEA,2DAA2D;QAC3D,IAAI,aAAa,KAAK;YACrB,MAAM,cAAc,QAAQ,OAAO,CAAC,KAAK;YAEzC,IAAI,CAAC,iBAAiB;gBACrB,yDAAyD;gBACzD,YAAY,QAAQ,GAAG;YACxB,OAAO,IAAI,CAAC,SAAS;gBACpB,uDAAuD;gBACvD,YAAY,QAAQ,GAAG;YACxB,OAAO;gBACN,kDAAkD;gBAClD,YAAY,QAAQ,GAAG;YACxB;YAEA,OAAO,qYAAY,CAAC,QAAQ,CAAC;QAC9B;QAEA,uCAAuC;QACvC,IAAI,CAAC,WAAW,aAAa,SAAS;YACrC,MAAM,cAAc,QAAQ,OAAO,CAAC,KAAK;YACzC,YAAY,QAAQ,GAAG;YACvB,OAAO,qYAAY,CAAC,QAAQ,CAAC;QAC9B;IACD;AACD;AAEO,MAAM,SAAS;IACrB,SAAS;QACR,6EAA6E;QAC7E;QACA,4BAA4B;QAC5B;KACA;AACF"}}]
}