(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,874799,e=>{"use strict";var t=e.i(843476),r=e.i(618566);e.i(250711);var s=e.i(982045),a=e.i(283164),i=e.i(907347),l=e.i(264036),n=e.i(829164),d=e.i(985902),o=e.i(361922),c=e.i(178583),x=e.i(263488),m=e.i(440160),g=e.i(286536),u=e.i(212426),h=e.i(607486),p=e.i(239616),b=e.i(688511),y=e.i(75505),j=e.i(643531);let f=(0,e.i(475254).default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var v=e.i(503116),N=e.i(191741),w=e.i(49789),k=e.i(574780),C=e.i(242554);let T=k.StyleSheet.create({page:{flexDirection:"column",backgroundColor:"#FFFFFF",padding:28,fontSize:11,fontFamily:"Helvetica"},logoSection:{marginBottom:16,alignItems:"flex-start"},logoContainer:{width:160,height:60},logo:{width:"100%",height:"100%",objectFit:"contain",objectPosition:"left center"},header:{flexDirection:"row",justifyContent:"space-between",marginBottom:24,paddingBottom:12,borderBottomWidth:2,borderBottomColor:"#000000"},headerLeft:{flexDirection:"column",maxWidth:280},headerRight:{flexDirection:"column",alignItems:"flex-end",justifyContent:"flex-start"},title:{fontSize:32,fontWeight:"bold",color:"#000000",marginBottom:8,letterSpacing:1},subtitle:{fontSize:10,color:"#374151",marginBottom:2,lineHeight:1.5},quoteNumber:{fontSize:20,fontWeight:"bold",color:"#000000",marginBottom:8},date:{fontSize:10,color:"#6B7280"},quoteMeta:{backgroundColor:"#F9FAFB",borderWidth:1,borderColor:"#E5E7EB",borderRadius:4,padding:10,minWidth:200},metaRow:{flexDirection:"row",justifyContent:"space-between",marginBottom:4},metaLabel:{fontSize:10,color:"#6B7280",fontWeight:"bold"},metaValue:{fontSize:10,color:"#1F2937",marginLeft:16},billToSection:{marginTop:8,marginBottom:16,padding:12,backgroundColor:"#F9FAFB",borderRadius:4},sectionTitle:{fontSize:11,fontWeight:"bold",color:"#1F2937",marginBottom:8,textTransform:"uppercase",letterSpacing:.5},billToContent:{fontSize:11,color:"#374151",lineHeight:1.6},itemsTable:{marginTop:12,marginBottom:16,borderWidth:1,borderColor:"#E5E7EB",borderRadius:4},tableHeader:{flexDirection:"row",backgroundColor:"#1F2937",paddingVertical:10,paddingHorizontal:12},tableRow:{flexDirection:"row",borderBottomWidth:1,borderBottomColor:"#E5E7EB",paddingVertical:10,paddingHorizontal:12,backgroundColor:"#FFFFFF"},tableCell:{fontSize:10,color:"#374151",lineHeight:1.4},tableCellDescription:{flex:3},tableCellQuantity:{flex:1,textAlign:"center"},tableCellUnit:{flex:1,textAlign:"center"},tableCellPrice:{flex:1.5,textAlign:"right"},tableCellTotal:{flex:1.5,textAlign:"right",fontWeight:"bold",color:"#1F2937"},tableHeaderCell:{fontSize:10,fontWeight:"bold",color:"#FFFFFF",textTransform:"uppercase",letterSpacing:.8},totalsSection:{flexDirection:"row",justifyContent:"flex-end",marginTop:12,marginBottom:16},totalsContainer:{width:260,borderWidth:1,borderColor:"#E5E7EB",borderRadius:4,padding:12,backgroundColor:"#F9FAFB"},totalRow:{flexDirection:"row",justifyContent:"space-between",paddingVertical:4},totalLabel:{fontSize:11,color:"#6B7280"},totalValue:{fontSize:11,color:"#374151",fontWeight:"bold"},grandTotalRow:{flexDirection:"row",justifyContent:"space-between",paddingVertical:8,paddingTop:10,borderTopWidth:2,borderTopColor:"#1F2937",marginTop:6},grandTotalLabel:{fontSize:14,fontWeight:"bold",color:"#000000"},grandTotalValue:{fontSize:16,fontWeight:"bold",color:"#000000"},termsSection:{marginTop:6,marginBottom:12,padding:12,backgroundColor:"#F9FAFB",borderRadius:4,borderLeftWidth:3,borderLeftColor:"#1F2937"},termsContent:{fontSize:10,color:"#4B5563",lineHeight:1.6},signatureSection:{marginTop:32,flexDirection:"row",justifyContent:"space-between",gap:40},signatureBox:{flex:1,borderBottomWidth:1.5,borderBottomColor:"#1F2937",paddingBottom:8},signatureLabel:{fontSize:10,color:"#6B7280",marginBottom:32,fontWeight:"bold",textTransform:"uppercase",letterSpacing:.5}}),S=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),F=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),D=({quote:e,client:r,items:s,organization:a})=>(0,t.jsx)(C.Document,{children:(0,t.jsxs)(C.Page,{size:"A4",style:T.page,children:[a?.logoUrl?(0,t.jsx)(C.View,{style:T.logoSection,children:(0,t.jsx)(C.View,{style:T.logoContainer,children:(0,t.jsx)(C.Image,{style:T.logo,src:a.logoUrl})})}):null,(0,t.jsxs)(C.View,{style:T.header,children:[(0,t.jsxs)(C.View,{style:T.headerLeft,children:[(0,t.jsx)(C.Text,{style:T.title,children:"QUOTE"}),a?.name?(0,t.jsx)(C.Text,{style:T.subtitle,children:a.name}):null,a?.address?(0,t.jsx)(C.Text,{style:T.subtitle,children:a.address}):null,a?.phone?(0,t.jsxs)(C.Text,{style:T.subtitle,children:["Phone: ",a.phone]}):null,a?.email?(0,t.jsxs)(C.Text,{style:T.subtitle,children:["Email: ",a.email]}):null]}),(0,t.jsxs)(C.View,{style:T.headerRight,children:[(0,t.jsxs)(C.Text,{style:T.quoteNumber,children:["Quote ",e.quoteNumber||`#${e._id.slice(-6)}`]}),(0,t.jsxs)(C.View,{style:T.quoteMeta,children:[(0,t.jsxs)(C.View,{style:T.metaRow,children:[(0,t.jsx)(C.Text,{style:T.metaLabel,children:"Date:"}),(0,t.jsx)(C.Text,{style:T.metaValue,children:F(e._creationTime)})]}),e.validUntil?(0,t.jsxs)(C.View,{style:T.metaRow,children:[(0,t.jsx)(C.Text,{style:T.metaLabel,children:"Valid Until:"}),(0,t.jsx)(C.Text,{style:T.metaValue,children:F(e.validUntil)})]}):null]})]})]}),(0,t.jsxs)(C.View,{style:T.billToSection,wrap:!1,children:[(0,t.jsx)(C.Text,{style:T.sectionTitle,children:"Bill To:"}),(0,t.jsx)(C.View,{style:T.billToContent,children:r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.Text,{children:r.companyName}),r.industry?(0,t.jsx)(C.Text,{children:r.industry}):null]}):(0,t.jsx)(C.Text,{children:"Client details unavailable"})})]}),(0,t.jsxs)(C.View,{style:T.itemsTable,wrap:!1,children:[(0,t.jsxs)(C.View,{style:T.tableHeader,children:[(0,t.jsx)(C.Text,{style:[T.tableHeaderCell,T.tableCellDescription],children:"Description"}),(0,t.jsx)(C.Text,{style:[T.tableHeaderCell,T.tableCellQuantity],children:"Qty"}),(0,t.jsx)(C.Text,{style:[T.tableHeaderCell,T.tableCellUnit],children:"Unit"}),(0,t.jsx)(C.Text,{style:[T.tableHeaderCell,T.tableCellPrice],children:"Rate"}),(0,t.jsx)(C.Text,{style:[T.tableHeaderCell,T.tableCellTotal],children:"Amount"})]}),s.map(e=>(0,t.jsxs)(C.View,{style:T.tableRow,children:[(0,t.jsx)(C.Text,{style:[T.tableCell,T.tableCellDescription],children:e.description}),(0,t.jsx)(C.Text,{style:[T.tableCell,T.tableCellQuantity],children:e.quantity}),(0,t.jsx)(C.Text,{style:[T.tableCell,T.tableCellUnit],children:e.unit}),(0,t.jsx)(C.Text,{style:[T.tableCell,T.tableCellPrice],children:S(e.rate)}),(0,t.jsx)(C.Text,{style:[T.tableCell,T.tableCellTotal],children:S(e.amount)})]},String(e._id)))]}),(0,t.jsx)(C.View,{style:T.totalsSection,wrap:!1,children:(0,t.jsxs)(C.View,{style:T.totalsContainer,children:[(0,t.jsxs)(C.View,{style:T.totalRow,children:[(0,t.jsx)(C.Text,{style:T.totalLabel,children:"Subtotal:"}),(0,t.jsx)(C.Text,{style:T.totalValue,children:S(e.subtotal)})]}),e.discountEnabled&&e.discountAmount?(0,t.jsxs)(C.View,{style:T.totalRow,children:[(0,t.jsx)(C.Text,{style:T.totalLabel,children:"Discount:"}),(0,t.jsx)(C.Text,{style:T.totalValue,children:"percentage"===e.discountType?`-${e.discountAmount}%`:`- ${S(e.discountAmount)}`})]}):null,e.taxEnabled&&e.taxAmount?(0,t.jsxs)(C.View,{style:T.totalRow,children:[(0,t.jsx)(C.Text,{style:T.totalLabel,children:"Tax:"}),(0,t.jsx)(C.Text,{style:T.totalValue,children:S(e.taxAmount)})]}):null,(0,t.jsxs)(C.View,{style:T.grandTotalRow,children:[(0,t.jsx)(C.Text,{style:T.grandTotalLabel,children:"Total:"}),(0,t.jsx)(C.Text,{style:T.grandTotalValue,children:S(e.total)})]})]})}),e.terms?(0,t.jsxs)(C.View,{style:T.termsSection,wrap:!1,children:[(0,t.jsx)(C.Text,{style:T.sectionTitle,children:"Terms & Conditions:"}),(0,t.jsx)(C.Text,{style:T.termsContent,children:e.terms})]}):null,e.clientMessage?(0,t.jsxs)(C.View,{style:T.termsSection,wrap:!1,children:[(0,t.jsx)(C.Text,{style:T.sectionTitle,children:"Message to Client:"}),(0,t.jsx)(C.Text,{style:T.termsContent,children:e.clientMessage})]}):null,(0,t.jsxs)(C.View,{style:T.signatureSection,wrap:!1,children:[(0,t.jsxs)(C.View,{style:{width:"45%"},children:[(0,t.jsx)(C.Text,{style:{fontSize:10,color:"#1F2937",marginBottom:5},children:"Signature:"}),(0,t.jsx)(C.Text,{style:{fontSize:8,color:"#FFFFFF"},children:"{{sign|1|*||client_signature}}"}),(0,t.jsx)(C.View,{style:{borderBottomWidth:1,borderBottomColor:"#1F2937",marginTop:20,width:"100%"}})]}),(0,t.jsxs)(C.View,{style:{width:"45%"},children:[(0,t.jsx)(C.Text,{style:{fontSize:10,color:"#1F2937",marginBottom:5},children:"Date:"}),(0,t.jsx)(C.Text,{style:{fontSize:8,color:"#FFFFFF"},children:"{{date|1|*||date_signed}}"}),(0,t.jsx)(C.View,{style:{borderBottomWidth:1,borderBottomColor:"#1F2937",marginTop:20,width:"100%"}})]})]})]})});var B=e.i(271645),A=e.i(147145),U=e.i(407107),z=e.i(493843),P=e.i(778917);function E({isOpen:e,onClose:r,onConfirm:i}){let[l,n]=(0,B.useState)([]),d=(0,s.useQuery)(a.api.organizationDocuments.list),o=()=>{n([]),r()};return(0,t.jsx)(A.default,{isOpen:e,onClose:o,title:"Append Documents to Quote",size:"lg",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Optionally select documents to append to your quote PDF. Selected documents will be added after the quote content, or continue without attachments."}),void 0===d?(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mx-auto"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mx-auto"})]})}):0===d.length?(0,t.jsxs)("div",{className:"text-center py-8 px-4 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg",children:[(0,t.jsx)(c.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-2 font-medium",children:"No documents available"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Upload documents in Settings â†’ Documents to use them in quotes"}),(0,t.jsx)("a",{href:"/organization/profile?tab=documents",target:"_blank",rel:"noopener noreferrer",children:(0,t.jsxs)(U.StyledButton,{intent:"outline",size:"sm",children:[(0,t.jsx)(P.ExternalLink,{className:"h-3 w-3 mr-2"}),"Go to Documents"]})})]}):(0,t.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:d.map(e=>{var r;return(0,t.jsxs)("label",{className:"flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-muted/50 cursor-pointer transition-colors",children:[(0,t.jsx)(z.Checkbox,{checked:l.includes(e._id),onCheckedChange:()=>{var t;return t=e._id,void n(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])}}),(0,t.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded bg-blue-100 dark:bg-blue-900/30 shrink-0",children:(0,t.jsx)(c.FileText,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.name}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)("span",{children:new Date(e.uploadedAt).toLocaleDateString()}),e.fileSize&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"â€¢"}),(0,t.jsx)("span",{children:(r=e.fileSize)?r<1024?`${r} B`:r<1048576?`${(r/1024).toFixed(1)} KB`:`${(r/1048576).toFixed(1)} MB`:""})]})]}),e.description&&(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1 line-clamp-1",children:e.description})]})]},e._id)})}),(0,t.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:l.length>0?(0,t.jsxs)("span",{children:[l.length," document",1!==l.length&&"s"," ","selected"]}):(0,t.jsx)("span",{className:"text-gray-500 dark:text-gray-400 italic",children:"No documents selected"})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(U.StyledButton,{intent:"outline",onClick:o,children:"Cancel"}),(0,t.jsx)(U.StyledButton,{intent:"primary",onClick:()=>{i(l),n([]),r()},children:l.length>0?`Generate with ${l.length} document${1!==l.length?"s":""}`:"Generate PDF Only"})]})]})]})})}var V=e.i(337837),L=e.i(152088);let $=({tags:e,setTags:r,editTag:s=!0,className:a})=>{let[i,l]=(0,B.useState)(""),[n,d]=(0,B.useState)(null),o=(0,B.useRef)(null),c=t=>{let s=i.trim();if(("Enter"===t.key||","===t.key)&&s){if(t.preventDefault(),null!==n){let t=[...e];t[n]=s,r(t),d(null)}else e.includes(s)||r([...e,s]);l("")}},x=()=>{if(null!==n){let t=[...e],s=i.trim();s?t[n]=s:t.splice(n,1),r(t),d(null)}l("")};return(0,B.useEffect)(()=>{o.current&&(o.current.style.width=`${i.length+1}ch`)},[i]),(0,t.jsxs)("div",{className:(0,L.cn)("flex flex-wrap w-full items-center gap-2 p-2 border-2 rounded-md focus-within:border-blue-500 dark:bg-neutral-800 bg-neutral-50",a),children:[e.map((a,m)=>(0,t.jsx)("div",{className:"relative",children:s&&n===m?(0,t.jsx)("input",{ref:o,type:"text",value:i,onChange:e=>l(e.target.value),onKeyDown:c,onBlur:x,className:"px-2 py-1 text-sm border dark:bg-neutral-950 bg-neutral-200 rounded outline-none",placeholder:"Edit tag...",style:{width:`${i.length+1.2}px`},autoFocus:!0}):(0,t.jsxs)("div",{onClick:()=>{s&&(l(e[m]),d(m),setTimeout(()=>o.current?.focus(),0))},className:"flex items-center gap-2 px-1 pl-2 py-1 text-sm font-medium text-white bg-blue-500 rounded cursor-pointer hover:bg-blue-600",children:[a,(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),r(e.filter(e=>e!==a)),null!==n&&d(null)},className:"text-primary px-1 focus:outline-none bg-primary-base rounded",children:"Ã—"})]})},a)),(0,t.jsx)("input",{type:"text",value:i,onChange:e=>l(e.target.value),onKeyDown:c,className:`flex-grow px-2 py-1 text-sm border-none outline-none  dark:bg-neutral-800 bg-neutral-50 rounded-md ${null!==n?"opacity-0":"opacity-100"}`,placeholder:"Add a tag..."})]})};var M=e.i(37727);function _({isOpen:e,onOpenChange:r,onConfirm:s,primaryContact:a,quoteNumber:l,documentVersion:n,children:d}){let[o,m]=(0,B.useState)([]),[g,u]=(0,B.useState)(""),[h,p]=(0,B.useState)(!1);(0,B.useEffect)(()=>{e&&(m([]),u(""))},[e]);let b=async()=>{if(a?.email&&!(o.filter(e=>!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)).length>0)){p(!0);try{let e=[{id:crypto.randomUUID(),name:`${a.firstName} ${a.lastName}`,email:a.email,signerType:"Signer"},...o.map(e=>({id:crypto.randomUUID(),name:e,email:e,signerType:"CC"}))];await s(e,g||void 0),r(!1)}catch(e){console.error("Send failed:",e)}finally{p(!1)}}},y=()=>{r(!1)},j=a?.email&&o.every(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))&&!h;return(0,t.jsxs)(V.Popover,{open:e,onOpenChange:r,children:[(0,t.jsx)(V.PopoverTrigger,{asChild:!0,children:d}),(0,t.jsx)(V.PopoverContent,{align:"end",side:"top",sideOffset:12,className:"w-[550px] p-0 bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl border border-gray-200 dark:border-gray-700 shadow-lg rounded-xl",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Mail,{className:"h-5 w-5 text-primary"}),(0,t.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Send Quote for Signature"})]}),(0,t.jsx)("button",{onClick:y,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",children:(0,t.jsx)(M.X,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"px-6 py-4 space-y-4",children:[l&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c.FileText,{className:"h-4 w-4 text-gray-400"}),(0,t.jsxs)(i.Badge,{variant:"outline",className:"text-xs",children:["Quote ",l,n&&` - v${n}`]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"To"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg",children:[(0,t.jsx)(x.Mail,{className:"h-4 w-4 text-gray-400"}),(0,t.jsx)("div",{className:"flex-1 text-sm text-gray-900 dark:text-white",children:a?.email?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"font-medium",children:[a.firstName," ",a.lastName]}),(0,t.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[" ","(",a.email,")"]})]}):(0,t.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"No primary contact email"})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"CC Recipients (optional)"}),(0,t.jsx)($,{tags:o,setTags:m,editTag:!1,className:"min-h-[42px]"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Add email and press Enter"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Message (optional)"}),(0,t.jsx)("textarea",{placeholder:"Add a message to your email...",value:g,onChange:e=>u(e.target.value),className:"w-full min-h-[80px] px-3 py-2 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/50 resize-y"})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:[(0,t.jsxs)("button",{onClick:y,disabled:h,className:`group inline-flex items-center gap-2 text-sm font-semibold transition-all duration-200 px-4 py-2 rounded-lg ring-1 shadow-sm hover:shadow-md backdrop-blur-sm text-gray-600 hover:text-gray-700 bg-white hover:bg-gray-50 ring-gray-200 hover:ring-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:bg-gray-900 dark:hover:bg-gray-800 dark:ring-gray-700 dark:hover:ring-gray-600 ${h?"opacity-50 cursor-not-allowed":""}`,children:["Cancel",!h&&(0,t.jsx)("span",{"aria-hidden":"true",className:"group-hover:translate-x-1 transition-transform duration-200",children:"â†’"})]}),(0,t.jsxs)("button",{onClick:b,disabled:!j,className:`group inline-flex items-center gap-2 text-sm font-semibold transition-all duration-200 px-4 py-2 rounded-lg ring-1 shadow-sm hover:shadow-md backdrop-blur-sm text-primary hover:text-primary/80 bg-primary/10 hover:bg-primary/15 ring-primary/30 hover:ring-primary/40 ${!j?"opacity-50 cursor-not-allowed":""}`,children:[(0,t.jsx)(x.Mail,{className:"h-4 w-4"}),h?"Sending...":"Send",!h&&(0,t.jsx)("span",{"aria-hidden":"true",className:"group-hover:translate-x-1 transition-transform duration-200",children:"â†’"})]})]})]})})]})}var R=e.i(955993);function q({status:e,events:r}){return(0,t.jsx)(R.StatusProgressBar,{status:e,steps:[{id:"Sent",name:"Sent",order:1},{id:"Viewed",name:"Viewed",order:2},{id:"Signed",name:"Signed",order:3},{id:"Completed",name:"Completed",order:4}],events:r,failureStatuses:["Declined","Revoked","Expired"],successStatuses:["Completed"]})}var Q=e.i(847555),I=e.i(374294);let H=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),W=e=>{switch(e){case"draft":return"Draft";case"sent":return"Sent";case"approved":return"Approved";case"declined":return"Declined";case"expired":return"Expired";default:return e}};function O(){var C,T;let S=(0,r.useRouter)(),F=(0,r.useParams)(),A=(0,o.useToast)(),U=(0,s.useConvex)(),z=F.quoteId,P=(0,s.useQuery)(a.api.quotes.get,{id:z}),V=(0,s.useQuery)(a.api.clients.get,P?.clientId?{id:P.clientId}:"skip"),L=(0,s.useQuery)(a.api.projects.get,P?.projectId?{id:P.projectId}:"skip"),$=(0,s.useQuery)(a.api.quoteLineItems.listByQuote,{quoteId:z}),M=(0,s.useQuery)(a.api.organizations.get,{}),O=(0,s.useQuery)(a.api.documents.getLatest,P?{documentType:"quote",documentId:P._id}:"skip"),G=(0,s.useQuery)(a.api.documents.getAllVersions,P?{documentType:"quote",documentId:P._id}:"skip"),K=(0,s.useQuery)(a.api.clientContacts.getPrimaryContact,P?.clientId?{clientId:P.clientId}:"skip"),Y=(0,s.useQuery)(a.api.clientContacts.listByClient,P?.clientId?{clientId:P.clientId}:"skip"),X=(0,s.useQuery)(a.api.clientProperties.getPrimaryProperty,P?.clientId?{clientId:P.clientId}:"skip"),J=(0,s.useQuery)(a.api.documents.getAllDocumentsWithSignatures,P?{documentType:"quote",documentId:P._id}:"skip"),Z=(0,s.useMutation)(a.api.quotes.update),ee=(0,s.useMutation)(a.api.documents.generateUploadUrl),et=(0,s.useMutation)(a.api.documents.create),er=(0,s.useAction)(a.api.boldsignActions.sendDocumentForSignature),[es,ea]=(0,B.useState)(!1),[ei,el]=(0,B.useState)({terms:"",clientMessage:"",validUntil:void 0}),[en,ed]=(0,B.useState)(null),[eo,ec]=(0,B.useState)(!1),[ex,em]=(0,B.useState)(!1),[eg,eu]=(0,B.useState)(!1),eh=(0,B.useMemo)(()=>en&&G?G.find(e=>e._id===en):O,[en,G,O]),ep=(0,s.useQuery)(a.api.documents.getDocumentUrl,eh?{id:eh._id}:"skip");(0,B.useEffect)(()=>{P&&el({terms:P.terms||"",clientMessage:P.clientMessage||"",validUntil:P.validUntil})},[P]);let eb=(0,B.useMemo)(()=>!!P&&((ei.terms||"")!==(P.terms||"")||(ei.clientMessage||"")!==(P.clientMessage||"")||(ei.validUntil||void 0)!==(P.validUntil||void 0)),[ei,P]),ey=async()=>{if(!P)return;let e={};if((ei.terms||"")!==(P.terms||"")&&(e.terms=ei.terms||void 0),(ei.clientMessage||"")!==(P.clientMessage||"")&&(e.clientMessage=ei.clientMessage||void 0),(ei.validUntil||void 0)!==(P.validUntil||void 0)&&(e.validUntil=ei.validUntil),0===Object.keys(e).length)return void ea(!1);try{await Z({id:z,...e}),A.success("Quote Updated","Your changes have been saved."),ea(!1)}catch(t){let e=t instanceof Error?t.message:"Failed to save changes";A.error("Error",e)}},ej=async e=>{try{await Z({id:z,status:e}),A.success("Quote Updated",`Status changed to ${W(e)}`)}catch(t){let e=t instanceof Error?t.message:"Failed to update status";A.error("Error",e)}};if(void 0===P)return(0,t.jsx)("div",{className:"min-h-screen flex-1 md:min-h-min",children:(0,t.jsxs)("div",{className:"relative bg-linear-to-br from-background via-muted/30 to-muted/60 dark:from-background dark:via-muted/20 dark:to-muted/40 min-h-screen rounded-xl",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_20%,rgba(120,119,198,0.08),transparent_50%)] rounded-xl"}),(0,t.jsx)("div",{className:"relative px-6 pt-8 pb-20",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-8",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-8",children:[(0,t.jsxs)("div",{className:"xl:col-span-3 space-y-8",children:[(0,t.jsx)("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded"}),(0,t.jsx)("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded"})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded"}),(0,t.jsx)("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded"})]})]})]})})]})});if(null===P)return(0,t.jsx)("div",{className:"min-h-screen flex-1 md:min-h-min",children:(0,t.jsxs)("div",{className:"relative bg-linear-to-br from-background via-muted/30 to-muted/60 dark:from-background dark:via-muted/20 dark:to-muted/40 min-h-screen rounded-xl",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_20%,rgba(120,119,198,0.08),transparent_50%)] rounded-xl"}),(0,t.jsxs)("div",{className:"relative px-6 pt-8 pb-20 flex flex-col items-center justify-center h-96 space-y-4",children:[(0,t.jsx)("div",{className:"text-6xl",children:"ðŸ“„"}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Quote Not Found"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-center",children:"The quote you're looking for doesn't exist or you don't have permission to view it."}),(0,t.jsx)(d.Button,{onClick:()=>S.push("/quotes"),children:"Back to Quotes"})]})]})});let ef=(C=P.status,T=P.validUntil,"expired"===C||T&&T<Date.now()?"expired":C),ev=async(r=[])=>{try{if(!P||!$)return;let s=A.loading("Generating PDF",r.length>0?`Merging with ${r.length} document${1!==r.length?"s":""}â€¦`:"Rendering and uploadingâ€¦"),i=(0,t.jsx)(D,{quote:P,client:V?{companyName:V.companyName,industry:V.industry}:void 0,items:$,organization:M?{name:M.name,logoUrl:M.logoUrl||void 0,address:M.address||void 0,phone:M.phone||void 0,email:M.email||void 0}:void 0}),l=await (0,k.pdf)(i).toBlob(),n=l;if(r.length>0)try{let{PDFDocument:t}=await e.A(66151),s=await U.query(a.api.organizationDocuments.getDocumentUrls,{ids:r});console.log("Fetched document URLs:",s);let i=await t.create(),d=await t.load(await l.arrayBuffer()),o=await i.copyPages(d,d.getPageIndices());for(let e of(o.forEach(e=>i.addPage(e)),console.log(`Added ${o.length} pages from quote PDF`),s))try{if(!e.url){console.warn(`No URL found for document ${e.id}`);continue}let r=await fetch(e.url);if(!r.ok){console.warn(`Failed to fetch PDF for document ${e.id}, status: ${r.status}`);continue}let s=await r.arrayBuffer(),a=await t.load(s),l=await i.copyPages(a,a.getPageIndices());l.forEach(e=>i.addPage(e)),console.log(`Successfully merged document ${e.id} (${l.length} pages)`)}catch(t){console.error(`Error processing document ${e.id}:`,t);continue}let c=await i.save();n=new Blob([c],{type:"application/pdf"}),console.log(`Merged PDF created with ${i.getPageCount()} total pages`)}catch(e){console.error("PDF merge error:",e),A.error("Merge failed","Failed to merge documents. Using quote only."),n=l}let d=await ee({}),o=await fetch(d,{method:"POST",headers:{"Content-Type":"application/pdf"},body:n});if(!o.ok)throw Error("Failed to upload PDF");let{storageId:c}=await o.json();await et({documentType:"quote",documentId:P._id,storageId:c}),A.removeToast(s),A.success("PDF generated",r.length>0?`Quote PDF with ${r.length} appended document${1!==r.length?"s":""} is ready.`:"Your quote PDF is ready.")}catch(t){console.error(t);let e=t instanceof Error?t.message:"Unknown error";A.error("PDF generation failed",e)}},eN=async()=>{if(ep)try{let e=await fetch(ep);if(!e.ok)throw Error("Failed to fetch PDF");let t=await e.blob(),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r;let a=eh?.version?`-v${eh.version}`:"";s.download=`Quote-${P?.quoteNumber||P?._id.slice(-6)||"document"}${a}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}catch(t){console.error(t);let e=t instanceof Error?t.message:"Unknown error";A.error("Download failed",e)}},ew=async(e,t)=>{if(!ep||!O)return void A.error("No PDF","Generate a PDF first");try{let r=e.filter(e=>"Signer"===e.signerType||"CC"===e.signerType);await er({quoteId:z,documentId:O._id,recipients:r,documentUrl:ep,message:t}),A.success("Sent!","Quote sent for signature via BoldSign"),eu(!1)}catch(t){let e=t instanceof Error?t.message:"Unknown error";A.error("Send failed",e)}};return(0,t.jsxs)("div",{className:"min-h-screen flex-1 md:min-h-min",children:[(0,t.jsxs)("div",{className:"relative min-h-screen rounded-xl",children:[(0,t.jsx)("div",{className:"rounded-xl"}),(0,t.jsx)("div",{className:"relative px-6 pt-8 pb-20",children:(0,t.jsxs)("div",{className:"mx-auto",children:[(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsxs)("div",{className:"flex items-center gap-8",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-center w-12 h-12 rounded-lg bg-blue-100 dark:bg-blue-900/30 shrink-0",children:(0,t.jsx)(c.FileText,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["Quote ",P.quoteNumber||`#${P._id.slice(-6)}`]}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:P.title||L?.title||"Untitled Quote"})]})]}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(R.StatusProgressBar,{status:ef,steps:[{id:"draft",name:"Draft",order:1},{id:"sent",name:"Sent",order:2},{id:"approved",name:"Approved",order:3}],events:[...P._creationTime?[{type:"draft",timestamp:P._creationTime}]:[],...P.sentAt?[{type:"sent",timestamp:P.sentAt}]:[],...P.approvedAt?[{type:"approved",timestamp:P.approvedAt}]:[],...P.declinedAt?[{type:"declined",timestamp:P.declinedAt}]:[]],failureStatuses:["declined","expired"],successStatuses:["approved"]})})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-8",children:[(0,t.jsxs)("div",{className:"xl:col-span-3 space-y-8",children:[(0,t.jsx)("div",{className:"bg-card dark:bg-card backdrop-blur-md border border-border dark:border-border rounded-xl shadow-lg dark:shadow-black/50 ring-1 ring-border/30 dark:ring-border/50",children:(0,t.jsxs)(l.Card,{className:"bg-transparent border-none shadow-none ring-0",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)(l.CardTitle,{className:"flex items-center justify-between text-xl",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(h.Building2,{className:"h-5 w-5"}),"Client and Project Details"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[L&&(0,t.jsxs)(d.Button,{intent:"outline",size:"sm",onClick:()=>S.push(`/projects/${L._id}`),children:[(0,t.jsx)(y.FolderOpen,{className:"h-4 w-4 mr-1"}),"View Project"]}),V&&(0,t.jsxs)(d.Button,{intent:"outline",size:"sm",onClick:()=>S.push(`/clients/${V._id}`),children:[(0,t.jsx)(b.Edit,{className:"h-4 w-4 mr-1"}),"View Client"]})]})]})}),(0,t.jsx)(l.CardContent,{children:(0,t.jsxs)("div",{className:"space-y-8",children:[V?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-4",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:V.companyName}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:V.industry||"No industry specified"}),V.companyDescription&&(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-2",children:V.companyDescription})]}),V.status&&(0,t.jsx)(i.Badge,{variant:"active"===V.status?"default":"outline",children:V.status})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[(0,t.jsx)(x.Mail,{className:"h-4 w-4"}),"Primary Contact"]}),K?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[K.firstName," ",K.lastName]}),K.jobTitle&&(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:K.jobTitle}),K.email&&(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:(0,t.jsx)("a",{href:`mailto:${K.email}`,className:"hover:text-blue-600 dark:hover:text-blue-400",children:K.email})}),K.phone&&(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:(0,t.jsx)("a",{href:`tel:${K.phone}`,className:"hover:text-blue-600 dark:hover:text-blue-400",children:K.phone})}),K.department&&(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:K.department})]}):(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No primary contact set"}),Y&&Y.length>1&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-3",children:["+",Y.length-1," additional contact",Y.length>2?"s":""]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[(0,t.jsx)(h.Building2,{className:"h-4 w-4"}),"Primary Location"]}),X?(0,t.jsxs)("div",{className:"space-y-2",children:[X.propertyName&&(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:X.propertyName}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[(0,t.jsx)("p",{children:X.streetAddress}),(0,t.jsxs)("p",{children:[X.city,","," ",X.state," ",X.zipCode]}),X.country&&(0,t.jsx)("p",{children:X.country})]}),X.propertyType&&(0,t.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:X.propertyType}),X.squareFootage&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:[X.squareFootage.toLocaleString()," ","sq ft"]})]}):(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No property address set"})]})]}),(V.category||V.clientSize||V.priorityLevel)&&(0,t.jsx)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[V.category&&(0,t.jsx)(i.Badge,{variant:"secondary",className:"text-xs",children:V.category}),V.clientSize&&(0,t.jsx)(i.Badge,{variant:"secondary",className:"text-xs",children:V.clientSize}),V.priorityLevel&&(0,t.jsxs)(i.Badge,{variant:"urgent"===V.priorityLevel||"high"===V.priorityLevel?"destructive":"secondary",className:"text-xs",children:[V.priorityLevel," priority"]})]})})]}):(0,t.jsxs)("div",{className:"p-6 border-2 border-dashed border-gray-300 dark:border-white/20 rounded-lg text-center",children:[(0,t.jsx)(h.Building2,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Client information not available"})]}),L&&(0,t.jsxs)("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[(0,t.jsx)(y.FolderOpen,{className:"h-4 w-4"}),"Associated Project"]}),L.status&&(0,t.jsx)(i.Badge,{variant:"in-progress"===L.status?"default":"completed"===L.status?"secondary":"outline",children:L.status})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:L.title}),L.projectNumber&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:["Project #",L.projectNumber]})]}),L.description&&(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:L.description}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 text-xs text-gray-500 dark:text-gray-500",children:[L.startDate&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(v.Clock,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:["Start:"," ",new Date(L.startDate).toLocaleDateString()]})]}),L.endDate&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(v.Clock,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:["End:"," ",new Date(L.endDate).toLocaleDateString()]})]}),L.projectType&&(0,t.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:L.projectType})]})]})]})]})})]})}),J&&J.length>0&&(0,t.jsx)("div",{className:"bg-card dark:bg-card backdrop-blur-md border border-border dark:border-border rounded-xl shadow-lg dark:shadow-black/50 ring-1 ring-border/30 dark:ring-border/50",children:(0,t.jsxs)(l.Card,{className:"bg-transparent border-none shadow-none ring-0",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2 text-xl",children:[(0,t.jsx)(c.FileText,{className:"h-5 w-5"}),"Signature Status"]})}),(0,t.jsx)(l.CardContent,{children:(0,t.jsx)(Q.default,{items:J.map(e=>{let r=e.boldsign.completedAt||e.boldsign.declinedAt||e.boldsign.revokedAt||e.boldsign.expiredAt||e.boldsign.signedAt||e.boldsign.viewedAt||e.boldsign.sentAt||e.generatedAt,s="Completed"===e.boldsign.status?"default":"Declined"===e.boldsign.status||"Revoked"===e.boldsign.status||"Expired"===e.boldsign.status?"destructive":"secondary",a=new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return{title:`Version ${e.version} - ${e.boldsign.status} - ${a}`,content:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 pb-3 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsxs)(i.Badge,{variant:"outline",className:"text-xs",children:["v",e.version]}),(0,t.jsx)(i.Badge,{variant:s,className:"text-xs",children:e.boldsign.status}),(0,t.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-auto",children:["Last updated: ",a]})]}),(0,t.jsx)(q,{status:e.boldsign.status,events:[{type:"Sent",timestamp:e.boldsign.sentAt},{type:"Viewed",timestamp:e.boldsign.viewedAt},{type:"Signed",timestamp:e.boldsign.signedAt},{type:e.boldsign.status,timestamp:e.boldsign.completedAt||e.boldsign.declinedAt||e.boldsign.revokedAt||e.boldsign.expiredAt}]}),(0,t.jsxs)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("p",{className:"font-medium mb-3 text-sm text-gray-900 dark:text-white",children:"Sent to:"}),(0,t.jsx)("ul",{className:"space-y-2",children:e.boldsign.sentTo.map((e,r)=>(0,t.jsxs)("li",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("span",{className:"text-gray-700 dark:text-gray-300",children:[(0,t.jsx)("span",{className:"font-medium",children:e.name})," ",(0,t.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:["(",e.email,")"]})]}),(0,t.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:e.signerType})]},r))})]})]})}})})})]})}),(0,t.jsx)("div",{className:"bg-card dark:bg-card backdrop-blur-md border border-border dark:border-border rounded-xl shadow-lg dark:shadow-black/50 ring-1 ring-border/30 dark:ring-border/50",children:(0,t.jsxs)(l.Card,{className:"bg-transparent border-none shadow-none ring-0",children:[(0,t.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2 text-xl",children:[(0,t.jsx)(u.DollarSign,{className:"h-5 w-5"}),"Line Items"]}),(0,t.jsxs)(d.Button,{intent:"outline",size:"sm",onPress:()=>S.push(`/quotes/${z}/quoteLineEditor`),children:[(0,t.jsx)(p.Settings,{className:"h-4 w-4 mr-2"}),"Edit Line Items"]})]}),(0,t.jsx)(l.CardContent,{children:$&&$.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"overflow-hidden rounded-lg border",children:(0,t.jsxs)(n.Table,{children:[(0,t.jsx)(n.TableHeader,{className:"bg-muted",children:(0,t.jsxs)(n.TableRow,{children:[(0,t.jsx)(n.TableHead,{children:"Description"}),(0,t.jsx)(n.TableHead,{className:"text-center",children:"Qty"}),(0,t.jsx)(n.TableHead,{className:"text-center",children:"Unit"}),(0,t.jsx)(n.TableHead,{className:"text-right",children:"Rate"}),(0,t.jsx)(n.TableHead,{className:"text-right",children:"Amount"})]})}),(0,t.jsx)(n.TableBody,{children:$.map(e=>(0,t.jsxs)(n.TableRow,{children:[(0,t.jsx)(n.TableCell,{className:"font-medium",children:e.description}),(0,t.jsx)(n.TableCell,{className:"text-center",children:e.quantity}),(0,t.jsx)(n.TableCell,{className:"text-center",children:e.unit||"item"}),(0,t.jsx)(n.TableCell,{className:"text-right",children:H(e.rate)}),(0,t.jsx)(n.TableCell,{className:"text-right font-medium",children:H(e.amount)})]},e._id))})]})}),(0,t.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Subtotal:"}),(0,t.jsx)("span",{className:"font-medium",children:H(P.subtotal)})]}),P.discountEnabled&&P.discountAmount&&(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Discount:"}),(0,t.jsxs)("span",{className:"font-medium text-red-600 dark:text-red-400",children:["-","percentage"===P.discountType?`${P.discountAmount}%`:H(P.discountAmount)]})]}),P.taxEnabled&&P.taxAmount&&(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Tax:"}),(0,t.jsx)("span",{className:"font-medium",children:H(P.taxAmount)})]}),(0,t.jsx)("div",{className:"border-t pt-2",children:(0,t.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,t.jsx)("span",{children:"Total:"}),(0,t.jsx)("span",{children:H(P.total)})]})})]})]}):(0,t.jsxs)("div",{className:"p-8 border-2 border-dashed border-gray-300 dark:border-white/20 rounded-lg text-center",children:[(0,t.jsx)(N.ClipboardList,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No line items added yet"})]})})]})}),(0,t.jsx)("div",{className:"bg-card dark:bg-card backdrop-blur-md border border-border dark:border-border rounded-xl shadow-lg dark:shadow-black/50 ring-1 ring-border/30 dark:ring-border/50",children:(0,t.jsxs)(l.Card,{className:"bg-transparent border-none shadow-none ring-0",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)(l.CardTitle,{className:"flex items-center justify-between text-xl",children:[(0,t.jsx)("span",{children:"Terms & Conditions"}),es?(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(d.Button,{intent:"outline",size:"sm",onClick:()=>{P&&el({terms:P.terms||"",clientMessage:P.clientMessage||"",validUntil:P.validUntil})},children:"Cancel"}),(0,t.jsx)(d.Button,{size:"sm",onClick:ey,isDisabled:!eb,children:"Save"})]}):(0,t.jsx)(d.Button,{intent:"outline",size:"sm",onClick:()=>ea(!0),children:(0,t.jsx)(b.Edit,{className:"h-4 w-4"})})]})}),(0,t.jsx)(l.CardContent,{children:es?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("textarea",{className:"w-full min-h-[100px] px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-white/10 rounded-md text-gray-900 dark:text-white",placeholder:"Enter terms",value:ei.terms,onChange:e=>el(t=>({...t,terms:e.target.value}))}),(0,t.jsx)("textarea",{className:"w-full min-h-[80px] px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-white/10 rounded-md text-gray-900 dark:text-white",placeholder:"Message to client (optional)",value:ei.clientMessage,onChange:e=>el(t=>({...t,clientMessage:e.target.value}))})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:P.terms||"No terms specified"}),P.clientMessage&&(0,t.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-white/10",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Message to Client:"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:P.clientMessage})]})]})})]})})]}),(0,t.jsx)("div",{className:"xl:col-span-1",children:(0,t.jsxs)("div",{className:"sticky top-24 space-y-6",children:[(0,t.jsx)("div",{className:"bg-card dark:bg-card backdrop-blur-md border border-border dark:border-border rounded-xl shadow-lg dark:shadow-black/50 ring-1 ring-border/30 dark:ring-border/50",children:(0,t.jsxs)(l.Card,{className:"bg-transparent border-none shadow-none ring-0",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsx)(l.CardTitle,{className:"text-lg",children:"Quote Details"})}),(0,t.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Created:"}),(0,t.jsx)("span",{className:"text-sm text-gray-900 dark:text-white",children:new Date(P._creationTime).toLocaleDateString()})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Status:"}),(0,t.jsx)(i.Badge,{variant:(e=>{switch(e){case"approved":return"default";case"sent":return"secondary";case"declined":case"expired":return"destructive";default:return"outline"}})(ef),children:W(ef)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Valid Until:"}),es?(0,t.jsx)("input",{type:"date",className:"w-40 h-9 px-2 py-1 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-white/10 rounded-md text-gray-900 dark:text-white",value:ei.validUntil?new Date(ei.validUntil).toISOString().slice(0,10):"",onChange:e=>el(t=>({...t,validUntil:e.target.value?new Date(e.target.value).getTime():void 0}))}):(0,t.jsx)("span",{className:"text-sm text-gray-900 dark:text-white",children:P.validUntil?new Date(P.validUntil).toLocaleDateString():"â€”"})]}),P.sentAt&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sent:"}),(0,t.jsx)("span",{className:"text-sm text-gray-900 dark:text-white",children:new Date(P.sentAt).toLocaleDateString()})]}),P.approvedAt&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Approved:"}),(0,t.jsx)("span",{className:"text-sm text-gray-900 dark:text-white",children:new Date(P.approvedAt).toLocaleDateString()})]})]})]})}),(0,t.jsx)("div",{className:"bg-card dark:bg-card backdrop-blur-md border border-border dark:border-border rounded-xl shadow-lg dark:shadow-black/50 ring-1 ring-border/30 dark:ring-border/50",children:(0,t.jsxs)(l.Card,{className:"bg-transparent border-none shadow-none ring-0",children:[(0,t.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.CardTitle,{className:"text-lg",children:"Generated PDF"}),eh&&(0,t.jsxs)(i.Badge,{variant:"outline",className:"text-xs",children:["v",eh.version]})]}),(0,t.jsx)(c.FileText,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})]}),(0,t.jsx)(l.CardContent,{children:(0,t.jsx)("div",{className:"text-center py-6",children:ep?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"h-48 bg-gray-50 dark:bg-gray-800 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden",children:(0,t.jsx)("iframe",{src:ep,className:"w-full h-full",title:"PDF Preview",style:{border:"none"}})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("a",{href:ep,target:"_blank",rel:"noopener noreferrer",className:"flex-1",children:(0,t.jsxs)(d.Button,{intent:"outline",size:"sm",className:"w-full",children:[(0,t.jsx)(g.Eye,{className:"h-4 w-4 mr-2"}),"View"]})}),(0,t.jsxs)(d.Button,{intent:"outline",size:"sm",className:"w-full flex-1",onClick:eN,children:[(0,t.jsx)(m.Download,{className:"h-4 w-4 mr-2"}),"Download"]})]}),G&&G.length>1&&(0,t.jsxs)("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700",children:[(0,t.jsxs)(d.Button,{intent:"outline",size:"sm",className:"w-full",onClick:()=>ec(!eo),children:[(0,t.jsx)(f,{className:"h-4 w-4 mr-2"}),eo?"Hide":"Show"," ","Version History (",G.length,")"]}),eo&&(0,t.jsx)("div",{className:"mt-3 space-y-2 max-h-48 overflow-y-auto",children:G.map(e=>(0,t.jsx)("button",{onClick:()=>{ed(e._id===O?._id?null:e._id)},className:`w-full text-left px-3 py-2 rounded-md text-sm transition-colors ${en===e._id||!en&&e._id===O?._id?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800":"bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v.Clock,{className:"h-3 w-3 text-gray-400"}),(0,t.jsxs)("span",{className:"font-medium",children:["Version ",e.version]}),e._id===O?._id&&(0,t.jsx)(i.Badge,{variant:"default",className:"text-xs",children:"Latest"})]}),(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[new Date(e.generatedAt).toLocaleDateString()," ",new Date(e.generatedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})},e._id))})]})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)(c.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"No PDF generated yet"}),(0,t.jsxs)(d.Button,{intent:"outline",size:"sm",onClick:()=>em(!0),children:[(0,t.jsx)(c.FileText,{className:"h-4 w-4 mr-2"}),"Generate PDF"]})]})})})]})})]})})]})]})}),(0,t.jsx)("div",{className:"px-6 mb-8",children:(0,t.jsx)(I.MentionSection,{entityType:"quote",entityId:z,entityName:P?.title||`Quote #${P?.quoteNumber||z.slice(-6)}`})})]}),(0,t.jsx)(w.StickyFormFooter,{hasUnsavedChanges:eb,isEditing:es,buttons:[...(()=>{if(!P)return null;switch(P.status){case"draft":return(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Button,{size:"sm",onClick:()=>ej("sent"),children:"Send Quote"}),(0,t.jsxs)(d.Button,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>ej("approved"),children:[(0,t.jsx)(j.Check,{className:"h-4 w-4 mr-1"})," Mark Approved"]})]});case"sent":return(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(d.Button,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>ej("approved"),children:[(0,t.jsx)(j.Check,{className:"h-4 w-4 mr-1"})," Approve"]}),(0,t.jsx)(d.Button,{size:"sm",intent:"outline",onClick:()=>ej("declined"),children:"Decline"}),(0,t.jsx)(d.Button,{size:"sm",intent:"outline",onClick:()=>ej("draft"),children:"Revert to Draft"})]});case"approved":case"declined":return(0,t.jsx)(d.Button,{size:"sm",intent:"outline",onClick:()=>ej("sent"),children:"Reopen (Sent)"});case"expired":return(0,t.jsx)(d.Button,{size:"sm",intent:"outline",onClick:()=>ej("draft"),children:"Reopen (Draft)"});default:return null}})()?[{label:P?.status==="draft"?"Mark as Sent":P?.status==="sent"?"Approve":P?.status==="approved"?"Reopen (Sent)":P?.status==="expired"?"Reopen (Draft)":"Update Status",intent:P?.status==="draft"?"primary":P?.status==="sent"?"success":"outline",icon:P?.status==="draft"?(0,t.jsx)(x.Mail,{className:"h-4 w-4"}):P?.status==="sent"?(0,t.jsx)(j.Check,{className:"h-4 w-4"}):(0,t.jsx)(b.Edit,{className:"h-4 w-4"}),onClick:()=>{P?.status==="draft"?ej("sent"):P?.status==="sent"?ej("approved"):P?.status==="approved"?ej("sent"):P?.status==="expired"&&ej("draft")},position:"left"}]:[],{label:"Send to Client",intent:"outline",icon:(0,t.jsx)(x.Mail,{className:"h-4 w-4"}),onClick:()=>eu(!0),position:"right"},{label:"Generate PDF",intent:"outline",icon:(0,t.jsx)(c.FileText,{className:"h-4 w-4"}),onClick:()=>em(!0),position:"right"}],fullWidth:!0}),(0,t.jsx)(E,{isOpen:ex,onClose:()=>em(!1),onConfirm:e=>ev(e)}),(0,t.jsx)(_,{isOpen:eg,onOpenChange:eu,onConfirm:ew,primaryContact:K,quoteNumber:P?.quoteNumber||P?._id.slice(-6),documentVersion:O?.version,children:(0,t.jsx)("div",{className:"fixed bottom-4 right-6 pointer-events-none"})})]})}e.s(["default",()=>O],874799)}]);